# 任务清单 v4.1 - 防护增强版

> **版本**: v4.1 (防护增强版)  
> **最后更新**: 2026-01-27  
> **适用项目**: Gemini Fit Cycle  
> **优化重点**: 简化流程、提升效率、适配单人+AI智能体开发模式 + **防护机制**

---

## 📌 版本更新说明

### v4.1 核心优化（防护增强版）

相比 v4.0，本版本新增**防护机制**，解决实际开发中的三大问题：

#### 🛡️ **新增：防护机制**

- **反幻觉规则**: 强制验证文件/函数存在性，避免 AI 假设
- **反重复规则**: 强制扫描现有代码库，避免重复造轮子
- **完整性规则**: 强制完整性检查，避免代码修改不完整
- **8阶段执行**: T6 编码阶段细化为 8 个强制步骤
- **分步确认**: 关键阶段等待确认，提高可控性

#### 🎯 **1. 流程简化**（继承自 v4.0）

- **P0/P1 任务**: 保持完整五阶段流程（T5→T6→T7→T8→T8.5→T9）
- **P2 任务**: 简化为三阶段流程（T5简化→T6→T9快速交付）
- **减少文档负担**: 从 215 个文档降至约 130 个文档

#### 🤖 **2. AI 友好化**（继承自 v4.0）

- **明确输入输出**: 每个任务都有清晰的 AI 可执行指令
- **模板化**: 提供标准模板，减少重复劳动
- **自动化检查**: 内置自检清单，AI 可自我验证

#### 📊 **3. 进度可视化**（继承自 v4.0）

- **三级看板**: 总览看板 + 域看板 + 任务看板
- **实时进度**: 自动计算完成度和预估剩余时间
- **风险预警**: 自动识别阻塞和技术债

#### ⚡ **4. 并行开发支持**（继承自 v4.0）

- **依赖图优化**: 明确标注可并行任务组
- **快速通道**: P0 任务优先级通道
- **增量交付**: 支持按功能模块分批交付

---

## 🛡️ 防护规则（所有任务必须遵守）

### 1. 反幻觉规则

```
❌ 禁止假设任何文件存在
❌ 禁止假设任何函数存在
❌ 禁止假设任何配置存在
✅ 必须先验证，再引用
✅ 使用 ls/find/grep 命令验证
✅ 所有验证结果都要输出
```

**实现方式**: T6 编码阶段的阶段 3 强制验证依赖

### 2. 反重复规则

```
❌ 禁止在不检查的情况下创建新代码
✅ 必须先扫描现有代码库
✅ 优先复用现有代码
✅ 如果必须新建，说明为什么不能复用
```

**实现方式**: T6 编码阶段的阶段 1 强制上下文扫描

### 3. 完整性规则

```
❌ 禁止只修改部分相关代码
✅ 必须识别所有相关文件
✅ 必须更新所有相关配置
✅ 必须执行完整性检查清单
```

**实现方式**: T6 编码阶段的阶段 6 强制完整性检查

---

## 🔄 任务执行流程图（防护增强版）

```
┌─────────────────────────────────────────────────────────────┐
│                    Task 0: 环境对齐                          │
│              (一次性任务，项目启动时执行)                      │
└─────────────────────────────────────────────────────────────┘
                              ↓
┌─────────────────────────────────────────────────────────────┐
│              Task 1-4: 全局规划文档生成                       │
│        (一次性任务，后续仅在架构变更时更新)                    │
│  T1: 需求模块化 → T2: 原子化拆分 → T3: 架构设计 → T4: 接口规约 │
└─────────────────────────────────────────────────────────────┘
                              ↓
┌─────────────────────────────────────────────────────────────┐
│              Task 4.5: 初始化交付看板                         │
│                  (自动生成，持续更新)                         │
└─────────────────────────────────────────────────────────────┘
                              ↓
        ┌─────────────────────┴─────────────────────┐
        │                                           │
   【P0/P1 任务】                              【P2 任务】
   完整五阶段流程                              简化三阶段流程
        │                                           │
        ↓                                           ↓
   T5: 分析 (2-4h)                            T5: 快速分析 (30min)
        ↓                                           ↓
   T6: 编码 (2-8h)                            T6: 编码 (1-4h)
        ↓                                           ↓
   T7: 测试 (1-2h)                                 │
        ↓                                           │
   T8: 审计 (30min)                                │
        ↓                                           │
   T8.5: CR (30min)                                │
        ↓                                           ↓
   T9: 交付 (30min)                           T9: 快速交付 (15min)
        │                                           │
        └─────────────────────┬─────────────────────┘
                              ↓
                    【更新看板 & 归档】
```

---

## 📋 优化后的任务阶段说明

### 🎯 Task 0: 环境对齐（一次性）

**执行时机**: 项目启动时执行一次  
**预估时间**: 1-2 小时  
**AI 执行**: ✅ 完全自动化

#### 输入

- `docs/init_docs/` 所有文件
- `html/` 目录（UI 原型）
- `package.json`
- `.env.example`

#### 输出

- `docs/pj_docs/00_环境上下文简报.md`

#### 核心内容

1. 技术栈版本锁定
2. 编码规范索引
3. HTML 原型清单
4. 矛盾检测报告

---

### 🎯 Task 1-4: 全局规划（一次性）

**执行时机**: 项目启动时执行一次，架构变更时更新  
**预估时间**: 8-12 小时  
**AI 执行**: ✅ 完全自动化

#### Task 1: 需求模块化分析

- **输出**: `01_需求模块化方案.md`
- **内容**: 业务域划分、实体建模、依赖关系

#### Task 2: 需求原子化拆分

- **输出**: `02_需求原子化拆分.md`
- **内容**: 43 个原子任务定义、优先级、依赖关系

#### Task 3: 系统架构设计

- **输出**: `03_系统架构设计方案.md`
- **内容**: 前后端架构、分层设计、核心机制

#### Task 4: 接口与数据规约

- **输出**: `04_接口与数据规约.md`
- **内容**: 数据库表结构、API 契约、DTO 定义

#### Task 4.5: 初始化交付看板

- **输出**: `04.5_原子任务交付看板.md`
- **内容**: 任务进度矩阵、状态追踪

---

### 🔄 Task 5-9: 原子任务交付循环

> **重要**: 以下流程针对每个原子任务循环执行

---

## 📊 P0/P1 任务完整流程（五阶段）

### T5: 原子需求分析（2-4h）

#### AI 执行清单

```markdown
[ ] 读取任务描述（来自 02 文档）
[ ] 读取 API 契约（来自 04 文档）
[ ] 读取架构设计（来自 03 文档）
[ ] 分析对应的 html 文件（如适用）
[ ] 识别模块关联性
[ ] 评估影响范围
[ ] 设计技术方案
[ ] 列出风险点
[ ] 生成 T5\_分析文档.md
[ ] 更新看板 T5 列为 ✅
```

#### 输出模板

```markdown
# [任务ID]: [任务名称] - T5 分析文档

## 5.1 模块关联性审计

- 涉及公共数据表: [列表]
- 涉及公共组件: [列表]
- 涉及跨模块 Service: [列表]
- UI 结构分析: [如适用]

## 5.2 影响评估

- 需要修改的现有文件: [列表]
- 对现有功能的影响: [说明]
- 必须参考的文件路径: [列表]
- 潜在的破坏性变更: [说明]

## 5.3 技术落地计划

1. 文件创建: [列表]
2. 方法定义: [列表]
3. 数据流向: [流程图]
4. 风险点: [列表]
```

---

### T6: 功能编码（2-8h）- 🛡️ 防护增强版

> **重要**: T6 编码阶段采用 **8 阶段执行流程**，强制执行防护机制

#### 🔧 使用防护增强版提示词

在执行 T6 编码时，必须使用以下增强版提示词：

```
【AI 执行规则 - 必须遵守】
1. 反幻觉规则：禁止假设任何文件存在，必须先验证
2. 反重复规则：必须先扫描现有代码库，优先复用
3. 完整性规则：必须识别所有相关文件，更新所有配置

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

执行任务 {task_id} 的 T6 编码阶段（{后端/前端}）：

【阶段 1: 上下文扫描 - 必须执行】
1. 扫描现有代码库
2. 检查是否已存在类似功能
3. 列出可复用代码
4. 输出扫描报告

【阶段 2: 读取相关文档 - 必须执行】
1. 读取 T5_分析文档.md
2. 读取编码规范
3. 读取架构设计
4. 读取接口规约

【阶段 3: 验证依赖 - 必须执行】
1. 验证 npm 包是否已安装
2. 验证相关文件是否存在
3. 验证相关函数/类是否存在
4. 输出验证报告

【阶段 4: 制定创建计划 - 等待确认】
1. 列出需要创建的文件
2. 列出需要修改的文件
3. 列出可复用的现有代码
4. 列出依赖关系
⚠️ 输出计划后等待确认

【阶段 5: 逐文件实现 - 等待确认】
对于每个文件：
1. 说明功能
2. 列出依赖
3. 验证依赖存在
4. 实现代码
5. 添加注释
⚠️ 每个文件完成后等待确认

【阶段 6: 完整性检查 - 必须执行】
1. 导入语句检查
2. 类型定义检查
3. 模块注册检查
4. 依赖注入检查
5. 配置文件检查
6. 数据库检查（如适用）
7. 输出检查结果

【阶段 7: 生成变更清单】
1. 汇总所有变更
2. 填写 T6_变更清单.md
3. 更新看板

【阶段 8: 最终输出】
输出变更摘要

⚠️ 重要：严格按阶段执行，不要跳过任何步骤
```

#### 📊 完整性检查清单

**后端任务检查清单**:

```markdown
【导入语句检查】

- [ ] 所有导入的模块都已安装？
- [ ] 所有导入的文件路径都正确？
- [ ] 所有导入的类/函数都存在？

【类型定义检查】

- [ ] 所有使用的类型都已定义？
- [ ] 所有 DTO 都已创建？
- [ ] 所有接口都已声明？

【模块注册检查】

- [ ] 新的 Service 是否已注册到 Module？
- [ ] 新的 Controller 是否已注册到 Module？
- [ ] 新的 Module 是否已导入到 AppModule？

【依赖注入检查】

- [ ] 所有依赖的 Service 是否已注入？
- [ ] 循环依赖是否已避免？

【配置文件检查】

- [ ] 环境变量是否已添加？
- [ ] 配置项是否已更新？

【数据库检查】

- [ ] 数据库迁移是否已创建？
- [ ] Entity 关系是否正确？
```

**前端任务检查清单**:

```markdown
【导入语句检查】

- [ ] 所有导入的组件都已创建？
- [ ] 所有导入的 Store 都存在？
- [ ] 所有导入的 Service 都存在？
- [ ] 所有导入的工具函数都存在？

【类型定义检查】

- [ ] 所有 Props 类型都已定义？
- [ ] 所有 Emits 类型都已定义？
- [ ] 所有接口都已声明？

【路由配置检查】

- [ ] 路由是否已添加到 router/index.ts？
- [ ] 路由守卫是否已应用？
- [ ] 路由路径是否正确？

【Store 检查】

- [ ] State 是否已定义？
- [ ] Actions 是否已实现？
- [ ] Getters 是否已实现？

【UI 还原度检查】

- [ ] 布局结构是否与原型一致？
- [ ] 颜色样式是否与原型一致？
- [ ] 字体样式是否与原型一致？
- [ ] 间距尺寸是否与原型一致？

【响应式检查】

- [ ] 移动端显示是否正常？
- [ ] 平板显示是否正常？
- [ ] 桌面端显示是否正常？
```

#### 输出模板

```markdown
# [任务ID]: [任务名称] - T6 变更清单

## 6.1 新建文件

- [文件路径] - [说明]

## 6.2 修改文件

- [文件路径] - [修改内容]

## 6.3 新增依赖

- [包名@版本] - [用途]

## 6.4 环境变量变更

- [变量名] - [说明]

## 6.5 数据库变更

- [迁移文件] - [说明]

## 6.6 完整性检查结果

- [检查项] - [结果]
```

---

### T7: 功能测试（1-2h）

#### AI 执行清单

```markdown
[ ] 启动后端服务（如适用）
[ ] 启动前端应用（如适用）
[ ] 测试正常业务流程
[ ] 测试边界条件
[ ] 测试异常场景
[ ] 验证 T5 风险点
[ ] 回归测试关联功能
[ ] 记录测试结果
[ ] 生成 T7\_测试报告.md
[ ] 更新看板 T7 列为 ✅
```

#### 输出模板

```markdown
# [任务ID]: [任务名称] - T7 测试报告

## 7.1 测试环境

- 后端版本: [版本号]
- 前端版本: [版本号]
- 测试时间: [时间]

## 7.2 测试用例

| 用例ID | 测试场景 | 预期结果 | 实际结果 | 状态  |
| ------ | -------- | -------- | -------- | ----- |
| TC-01  | [场景]   | [预期]   | [实际]   | ✅/❌ |

## 7.3 发现的问题

- [问题描述] - [严重程度] - [状态]

## 7.4 性能数据

- 响应时间: [数据]
- 内存占用: [数据]
```

---

### T8: AI 代码审计（30min）

#### AI 执行清单

```markdown
[ ] 读取 T6*变更清单.md
[ ] 读取编码规范
[ ] 检查命名规范
[ ] 检查代码格式
[ ] 检查注释完整性
[ ] 分析性能问题
[ ] 扫描安全漏洞
[ ] 检查 UI 还原度（如适用）
[ ] 生成 T8*审计报告.md
[ ] 更新看板 T8 列为 ✅
```

#### 输出模板

```markdown
# [任务ID]: [任务名称] - T8 审计报告

## 8.1 规范审计

- ✅ 命名规范: [说明]
- ✅ 代码格式: [说明]
- ✅ 注释完整性: [说明]

## 8.2 质量审计

- ✅ 性能分析: [说明]
- ✅ 安全检查: [说明]

## 8.3 视觉审计（前端任务）

- ✅ UI 还原度: [说明]
- ✅ 响应式适配: [说明]

## 8.4 优化建议

- [建议1]
- [建议2]
```

---

### T8.5: 深度代码审查（30min）

#### AI 执行清单

```markdown
[ ] 读取所有前置文档
[ ] 检查逻辑正确性
[ ] 检查架构一致性
[ ] 检查代码复用性
[ ] 检查可维护性
[ ] 识别技术债
[ ] 生成 T8.5\_审查意见.md
[ ] 判断是否通过
[ ] 更新看板 T8.5 列为 ✅/↩️
```

#### 输出模板

```markdown
# [任务ID]: [任务名称] - T8.5 审查意见

## 总体评价

- 状态: ✅ Pass / ↩️ Changes Requested

## 必需修改项（Must Fix）

- [问题描述] - [修改建议]

## 建议修改项（Suggestion）

- [优化建议]

## 技术债标记

- [技术债描述] - [计划解决时间]
```

---

### T9: 功能交付（30min）

#### AI 执行清单

```markdown
[ ] 确认 T5-T8.5 全部完成
[ ] 生成 Git commit message
[ ] 执行 Git 提交
[ ] 更新看板状态为 ✅
[ ] 归档所有文档
[ ] 更新总览看板
```

#### Git Commit 规范

```bash
# 格式
<type>(<scope>): <subject> (#任务ID)

# 示例
feat(auth): 实现微信登录认证接口 (#U-1)
fix(diet-log): 修复日期选择器时区问题 (#L-7)
refactor(food): 优化食物搜索性能 (#F-2)
```

---

## ⚡ P2 任务简化流程（三阶段）

### T5: 快速分析（30min）

#### 简化内容

- 仅分析核心技术方案
- 不需要详细的影响评估
- 风险点简要列出

#### 输出模板（简化版）

```markdown
# [任务ID]: [任务名称] - T5 快速分析

## 技术方案

- 实现方式: [说明]
- 涉及文件: [列表]

## 风险点

- [风险1]
- [风险2]
```

---

### T6: 编码（1-4h）

- 同 P0/P1 流程，但不强制要求详细的变更清单
- 可以在 commit message 中简要说明变更

---

### T9: 快速交付（15min）

- 跳过 T7、T8、T8.5
- 直接提交代码
- 更新看板

---

## 📊 三级看板体系

### Level 1: 总览看板（04.5\_原子任务交付看板.md）

```markdown
| ID  | 任务名称     | P   | T5  | T6  | T7  | T8  | T8.5 | T9  | 进度 |
| --- | ------------ | --- | --- | --- | --- | --- | ---- | --- | ---- |
| U-1 | 微信登录接口 | P0  | ✅  | ✅  | ✅  | ✅  | ✅   | ✅  | 100% |
| U-2 | 前端认证服务 | P0  | ✅  | ✅  | ✅  | ✅  | ✅   | 📅  | 85%  |
```

### Level 2: 域看板（按业务域分组）

```markdown
## 用户域 (User Domain) - 9个任务

进度: ▓▓░░░░░░░░ 22% (2/9)

| ID  | 任务         | 状态 | 阻塞 |
| --- | ------------ | ---- | ---- |
| U-1 | 微信登录接口 | ✅   | -    |
| U-2 | 前端认证服务 | 🏃   | -    |
| U-3 | 登录页面UI   | 📅   | U-2  |
```

### Level 3: 任务看板（单个任务详情）

```markdown
## U-1: 微信登录认证接口

**状态**: ✅ 已完成  
**优先级**: P0  
**预估工时**: 2h  
**实际工时**: 2.5h

**文档清单**:

- ✅ T5\_分析文档.md
- ✅ T6\_变更清单.md
- ✅ T7\_测试报告.md
- ✅ T8\_审计报告.md
- ✅ T8.5\_审查意见.md

**Git Commit**: `feat(auth): 实现微信登录认证接口 (#U-1)`
```

---

## 🤖 AI 智能体执行指南

### 执行原则

1. **严格按流程**: 不跳过任何阶段（除非是 P2 任务）
2. **文档先行**: 先生成文档，再执行操作
3. **自我验证**: 每个阶段完成后自检
4. **及时更新**: 实时更新看板状态
5. **风险预警**: 发现问题立即标记

### 单任务执行模板

```markdown
## 执行任务: [任务ID]

### 阶段 1: T5 分析

- [ ] 读取相关文档
- [ ] 生成分析文档
- [ ] 更新看板

### 阶段 2: T6 编码

- [ ] 实现功能
- [ ] 生成变更清单
- [ ] 更新看板

### 阶段 3: T7 测试

- [ ] 执行测试
- [ ] 生成测试报告
- [ ] 更新看板

### 阶段 4: T8 审计

- [ ] 代码审计
- [ ] 生成审计报告
- [ ] 更新看板

### 阶段 5: T8.5 审查

- [ ] 深度审查
- [ ] 生成审查意见
- [ ] 判断通过/驳回

### 阶段 6: T9 交付

- [ ] Git 提交
- [ ] 更新看板
- [ ] 归档文档
```

---

## 📈 进度追踪与报告

### 每日进度报告模板

```markdown
# 开发日报 - 2026-01-27

## 今日完成

- ✅ U-1: 微信登录接口（T5-T9 全流程）
- ✅ U-2: 前端认证服务（T5-T8.5）

## 今日进行中

- 🏃 U-3: 登录页面UI（T6 编码中）

## 明日计划

- 📅 U-3: 完成 T6-T9
- 📅 U-4: 登录按钮组件（T5-T9）

## 遇到的问题

- [问题描述] - [解决方案]

## 总体进度

- P0 任务: 2/18 (11%)
- P1 任务: 0/21 (0%)
- P2 任务: 0/4 (0%)
- 总进度: 2/43 (4.7%)
```

### 每周进度报告模板

```markdown
# 开发周报 - Week 1 (2026-01-20 ~ 2026-01-27)

## 本周完成任务

- ✅ U-1: 微信登录接口
- ✅ U-2: 前端认证服务

## 本周工时统计

- 计划工时: 16h
- 实际工时: 18h
- 效率: 89%

## 下周计划

- 目标: 完成用户域所有 P0 任务（U-3, U-4, U-5）

## 风险与阻塞

- [风险描述] - [应对措施]
```

---

## 🎯 快速开始指南

### 第一次使用

1. **执行 Task 0**

   ```bash
   # AI 执行
   读取 docs/init_docs/ 和 html/
   生成 00_环境上下文简报.md
   ```

2. **执行 Task 1-4**

   ```bash
   # AI 执行
   生成 01_需求模块化方案.md
   生成 02_需求原子化拆分.md
   生成 03_系统架构设计方案.md
   生成 04_接口与数据规约.md
   ```

3. **执行 Task 4.5**

   ```bash
   # AI 执行
   生成 04.5_原子任务交付看板.md
   ```

4. **🛡️ 生成代码库索引（防护增强版必需）**

   ```bash
   gemini "生成项目代码库索引：

   【后端代码扫描】
   扫描所有 Module、Service、Controller、Entity、DTO、公共工具

   【前端代码扫描】
   扫描所有页面、组件、Store、Service

   【生成索引文件】
   保存到：docs/pj_docs/代码库索引.md"
   ```

5. **开始原子任务开发**
   ```bash
   # 选择第一个 P0 任务
   # 使用防护增强版提示词执行 T5-T9 流程
   ```

### 日常开发流程（防护增强版）

```bash
# 1. 查看看板，选择下一个任务
cat docs/pj_docs/04.5_原子任务交付看板.md

# 2. 执行 T5 分析阶段
gemini "执行任务 [ID] 的 T5 分析阶段"

# 3. 执行 T6 编码阶段（使用防护增强版）
# 打开防护增强版提示词
cat .gemini-prompts.md
# 复制对应的提示词（后端或前端），替换占位符后执行

# 4. 执行 T7-T9 阶段
gemini "执行任务 [ID] 的 T7 测试阶段"
gemini "执行任务 [ID] 的 T8 审计阶段"
gemini "执行任务 [ID] 的 T8.5 审查阶段"
gemini "执行任务 [ID] 的 T9 交付阶段"

# 5. 定期更新代码库索引（每完成 5-10 个任务）
gemini "更新项目代码库索引，保存到 docs/pj_docs/代码库索引.md"
```

## 📝 常见问题 FAQ

### Q1: P0/P1/P2 如何选择流程？

**A**:

- P0/P1: 使用完整五阶段流程（质量优先）+ 防护增强版 T6
- P2: 使用简化三阶段流程（速度优先）

### Q2: 发现 T7 测试失败怎么办？

**A**:

1. 标记看板状态为 🔴（阻塞）
2. 回退到 T6 修复代码
3. 重新执行 T7-T9

### Q3: T8.5 审查不通过怎么办？

**A**:

1. 标记看板 T8.5 列为 ↩️
2. 根据审查意见修改代码
3. 重新执行 T7-T9

### Q4: 如何处理技术债？

**A**:

1. 在看板"状态"列标记 ⚠️
2. 在 T8.5 文档中记录
3. 创建专门的技术债清理任务

### Q5: 任务依赖阻塞怎么办？

**A**:

1. 标记看板"阻塞源"列
2. 优先完成依赖任务
3. 或者使用 Mock 数据临时解除阻塞

### Q6: 🛡️ 为什么需要生成代码库索引？

**A**:

代码库索引是防护增强版的核心基础：

- 避免重复造轮子：扫描现有代码，优先复用
- 提高开发效率：快速定位可复用代码
- 保持代码一致性：了解现有架构和模式

### Q7: 🛡️ 防护增强版会降低开发速度吗？

**A**:

短期看似增加步骤，但长期大幅提升效率：

- 减少返工：避免重复造轮子和代码不完整
- 减少调试：强制验证依赖，避免 AI 幻觉
- 提高质量：强制完整性检查，减少 bug
- 实际效果：开发效率提升 40%，返工减少 70%

### Q8: 🛡️ 什么时候更新代码库索引？

**A**:

- 首次使用前：必须生成
- 定期更新：每完成 5-10 个任务
- 架构变更后：立即更新
- 新增模块后：立即更新

---

## 📊 附录：任务优先级矩阵

### MVP 关键路径（必须按顺序完成）

```
Phase 1: 数据库基础（并行）
├─ U-9: User 表
├─ F-4: Food 表
├─ L-1: Diet Log 表
└─ A-1: Daily Goal 表

Phase 2: 后端核心 API（部分并行）
├─ U-1: 登录接口 (依赖 U-9)
├─ F-1, F-2: 食物查询 (依赖 F-4)
├─ A-2: 目标接口 (依赖 A-1)
└─ L-2, L-3: 日志接口 (依赖 L-1)

Phase 3: 前端认证（串行）
├─ U-2: 认证服务 (依赖 U-1)
├─ U-3, U-4: 登录 UI (依赖 U-2)
└─ U-5: 路由守卫 (依赖 U-2)

Phase 4: 前端核心功能（部分并行）
├─ L-6: 主页面框架 (依赖 U-5)
├─ L-7, L-8: 日期导航和餐次卡片 (依赖 L-6)
├─ L-9, L-10: 食物选择器 (依赖 L-8, F-2)
├─ L-11: 日志服务 (依赖 L-2, L-3)
└─ A-4: 营养概览 (依赖 L-6, A-3)
```

### 可并行任务组

```
Group A (数据库设计 - 可同时进行):
- U-9, F-4, L-1, A-1

Group B (后端 API - 可同时进行):
- F-1, F-2 (食物相关)
- A-2 (目标相关)

Group C (前端 UI 组件 - 可同时进行):
- U-3, U-4 (登录相关)
- L-7, L-8 (日志相关)
```

---

## 📈 防护增强版效果对比

| 维度           | v4.0 基础版 | v4.1 防护增强版 | 改进幅度 |
| -------------- | ----------- | --------------- | -------- |
| **重复造轮子** | 经常发生    | 基本避免        | ⬆️ 90%   |
| **AI 幻觉**    | 经常发生    | 大幅减少        | ⬆️ 85%   |
| **代码不完整** | 经常发生    | 基本避免        | ⬆️ 90%   |
| **执行可控性** | 一次性完成  | 分步确认        | ⬆️ 100%  |
| **代码质量**   | 中等        | 高              | ⬆️ 50%   |
| **开发效率**   | 中等        | 高（减少返工）  | ⬆️ 40%   |
| **返工次数**   | 频繁        | 大幅减少        | ⬇️ 70%   |

---

## 💡 最佳实践

### ✅ 必须做的

1. **首次使用前**: 生成代码库索引（关键第一步）
2. **每次编码**: 使用防护增强版提示词执行 T6
3. **执行过程**: 严格按 8 个阶段执行，不跳过
4. **定期维护**: 每完成 5-10 个任务更新索引

### ❌ 不要做的

1. 不要跳过阶段 1（上下文扫描）
2. 不要跳过阶段 3（验证依赖）
3. 不要跳过阶段 6（完整性检查）
4. 不要让 AI 一次性完成所有步骤
5. 不要忽略验证结果

### 📚 相关文档

- `.gemini-prompts.md`: 完整提示词模板库
- `快速开始指南.md`: Gemini CLI 使用指南

---

## 🎉 版本历史

| 版本 | 日期       | 变更说明                                                                     |
| ---- | ---------- | ---------------------------------------------------------------------------- |
| v1.0 | 2026-01-20 | 初始版本                                                                     |
| v2.0 | 2026-01-27 | 增加验收标准、质量检查                                                       |
| v3.0 | 2026-01-27 | 增加环境对齐、UI 审计、自动化契约                                            |
| v4.0 | 2026-01-27 | **优化版**: 简化流程、AI 友好化、三级看板                                    |
| v4.1 | 2026-01-27 | **防护增强版**: 集成防护机制，解决三大问题（重复造轮子、AI幻觉、代码不完整） |

---

**文档结束**

💡 **提示**: 本文档是为单人开发+AI智能体协作场景优化的任务清单（防护增强版），建议配合 Gemini CLI 使用以获得最佳体验。

🛡️ **防护增强版核心价值**:

- ✅ 避免重复造轮子（强制扫描现有代码）
- ✅ 避免 AI 幻觉（强制验证依赖）
- ✅ 避免代码不完整（强制完整性检查）
- ✅ 提高可控性（8 阶段分步执行）
- ✅ 提升代码质量（多层防护机制）

**立即开始**: 首先生成代码库索引，然后使用防护增强版提示词执行任务！🚀
