<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>饮食记录应用 - 测试页面</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@300;400;500;600;700&family=Noto+Serif+SC:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Noto Sans SC', sans-serif;
            background: linear-gradient(135deg, #f0fdf4 0%, #ecfdf5 100%);
        }
        .hero-title {
            font-family: 'Noto Serif SC', serif;
        }
        .glass-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
    </style>
</head>
<body class="min-h-screen">
    <!-- Header -->
    <div class="bg-white shadow-sm">
        <div class="px-4 py-6">
            <div class="flex items-center justify-between">
                <div class="flex items-center">
                    <h1 class="hero-title text-xl font-bold text-gray-800">饮食记录应用测试</h1>
                </div>
                <button onclick="clearAllData()" class="bg-red-500 text-white px-4 py-2 rounded-lg text-sm font-medium hover:bg-red-600 transition-colors">
                    清除数据
                </button>
            </div>
        </div>
    </div>

    <!-- Main Content -->
    <div class="px-4 py-6 pb-20">
        <!-- 功能测试区域 -->
        <div class="space-y-6">
            <!-- 计划创建测试 -->
            <div class="glass-card rounded-2xl p-4 shadow-lg">
                <h3 class="text-lg font-semibold text-gray-800 mb-4">计划创建功能</h3>
                <div class="space-y-3">
                    <button onclick="testPlanCreation()" class="w-full bg-emerald-600 text-white py-3 px-4 rounded-lg font-medium hover:bg-emerald-700 transition-colors">
                        测试创建新计划
                    </button>
                    <button onclick="testPlanList()" class="w-full bg-blue-600 text-white py-3 px-4 rounded-lg font-medium hover:bg-blue-700 transition-colors">
                        测试计划列表
                    </button>
                    <button onclick="testDailyPlan()" class="w-full bg-purple-600 text-white py-3 px-4 rounded-lg font-medium hover:bg-purple-700 transition-colors">
                        测试每日计划
                    </button>
                </div>
            </div>

            <!-- 食材选择器测试 -->
            <div class="glass-card rounded-2xl p-4 shadow-lg">
                <h3 class="text-lg font-semibold text-gray-800 mb-4">食材选择器功能</h3>
                <div class="space-y-3">
                    <button onclick="testFoodSelector()" class="w-full bg-orange-600 text-white py-3 px-4 rounded-lg font-medium hover:bg-orange-700 transition-colors">
                        测试食材选择器
                    </button>
                </div>
            </div>

            <!-- 数据管理测试 -->
            <div class="glass-card rounded-2xl p-4 shadow-lg">
                <h3 class="text-lg font-semibold text-gray-800 mb-4">数据管理</h3>
                <div class="space-y-3">
                    <button onclick="showLocalStorage()" class="w-full bg-gray-600 text-white py-3 px-4 rounded-lg font-medium hover:bg-gray-700 transition-colors">
                        查看本地存储数据
                    </button>
                    <button onclick="generateSampleData()" class="w-full bg-yellow-600 text-white py-3 px-4 rounded-lg font-medium hover:bg-yellow-700 transition-colors">
                        生成示例数据
                    </button>
                </div>
            </div>

            <!-- 测试结果 -->
            <div class="glass-card rounded-2xl p-4 shadow-lg">
                <h3 class="text-lg font-semibold text-gray-800 mb-4">测试结果</h3>
                <div id="testResults" class="space-y-2 text-sm text-gray-600">
                    <p>点击上方按钮开始测试...</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        // 测试函数
        function addTestResult(message, type = 'info') {
            const container = document.getElementById('testResults');
            const div = document.createElement('div');
            div.className = `p-2 rounded ${type === 'success' ? 'bg-emerald-100 text-emerald-700' : 
                                         type === 'error' ? 'bg-red-100 text-red-700' : 
                                         type === 'warning' ? 'bg-yellow-100 text-yellow-700' : 'bg-blue-100 text-blue-700'}`;
            div.textContent = message;
            container.appendChild(div);
            
            // 滚动到底部
            container.scrollTop = container.scrollHeight;
        }

        function clearResults() {
            document.getElementById('testResults').innerHTML = '<p>点击上方按钮开始测试...</p>';
        }

        function testPlanCreation() {
            clearResults();
            addTestResult('开始测试计划创建功能...', 'info');
            
            try {
                // 测试跳转到计划创建页面
                addTestResult('跳转到计划创建页面...', 'info');
                setTimeout(() => {
                    window.location.href = 'plan-creator.html';
                }, 1000);
            } catch (error) {
                addTestResult(`测试失败: ${error.message}`, 'error');
            }
        }

        function testPlanList() {
            clearResults();
            addTestResult('开始测试计划列表功能...', 'info');
            
            try {
                // 检查是否有已创建的计划
                const plans = JSON.parse(localStorage.getItem('dietPlans') || '[]');
                if (plans.length > 0) {
                    addTestResult(`找到 ${plans.length} 个计划`, 'success');
                    const activePlan = plans.find(p => p.isActive);
                    if (activePlan) {
                        addTestResult(`当前激活计划: ${activePlan.name}`, 'success');
                        addTestResult('跳转到计划列表页面...', 'info');
                        setTimeout(() => {
                            window.location.href = `daily-list.html?planId=${activePlan.id}`;
                        }, 1000);
                    } else {
                        addTestResult('没有找到激活的计划', 'warning');
                        addTestResult('请先创建一个计划', 'warning');
                    }
                } else {
                    addTestResult('没有找到任何计划', 'warning');
                    addTestResult('请先创建一个计划', 'warning');
                }
            } catch (error) {
                addTestResult(`测试失败: ${error.message}`, 'error');
            }
        }

        function testDailyPlan() {
            clearResults();
            addTestResult('开始测试每日计划功能...', 'info');
            
            try {
                const plans = JSON.parse(localStorage.getItem('dietPlans') || '[]');
                if (plans.length > 0) {
                    const plan = plans[0];
                    if (plan.dailyPlans && plan.dailyPlans.length > 0) {
                        const day = plan.dailyPlans[0];
                        addTestResult('跳转到每日计划页面...', 'info');
                        setTimeout(() => {
                            window.location.href = `daily-plan.html?planId=${plan.id}&dayId=${day.id}`;
                        }, 1000);
                    } else {
                        addTestResult('计划中没有日期数据', 'warning');
                    }
                } else {
                    addTestResult('没有找到计划', 'warning');
                }
            } catch (error) {
                addTestResult(`测试失败: ${error.message}`, 'error');
            }
        }

        function testFoodSelector() {
            clearResults();
            addTestResult('测试食材选择器功能...', 'info');
            
            try {
                // 创建一个新的iframe来测试食材选择器
                const iframe = document.createElement('iframe');
                iframe.src = 'food-selector-embedded.html';
                iframe.style.width = '100%';
                iframe.style.height = '400px';
                iframe.style.border = '1px solid #e5e7eb';
                iframe.style.borderRadius = '12px';
                
                document.getElementById('testResults').appendChild(document.createElement('hr'));
                document.getElementById('testResults').appendChild(iframe);
                
                addTestResult('食材选择器已加载', 'success');
            } catch (error) {
                addTestResult(`测试失败: ${error.message}`, 'error');
            }
        }

        function showLocalStorage() {
            clearResults();
            addTestResult('查看本地存储数据...', 'info');
            
            try {
                const plans = JSON.parse(localStorage.getItem('dietPlans') || '[]');
                const activePlanId = localStorage.getItem('activePlanId');
                
                addTestResult(`找到 ${plans.length} 个计划`, 'info');
                addTestResult(`激活计划ID: ${activePlanId || '无'}`, 'info');
                
                plans.forEach((plan, index) => {
                    addTestResult(`计划 ${index + 1}: ${plan.name} (${plan.totalDays}天)`, 'info');
                });
                
                if (plans.length === 0) {
                    addTestResult('本地存储为空', 'warning');
                }
            } catch (error) {
                addTestResult(`查看失败: ${error.message}`, 'error');
            }
        }

        function generateSampleData() {
            clearResults();
            addTestResult('生成示例数据...', 'info');
            
            try {
                const samplePlan = {
                    id: 'sample_plan_' + Date.now(),
                    name: '示例减脂计划',
                    type: 'fat-loss',
                    startDate: '2025-01-01',
                    cycleDays: 7,
                    cycleCount: 4,
                    totalDays: 28,
                    targetMode: 'individual',
                    defaultTargets: {
                        calories: 1800,
                        protein: 120,
                        fat: 50,
                        carbs: 180
                    },
                    dailyPlans: [],
                    createdAt: new Date().toISOString(),
                    isActive: true
                };
                
                // 生成每日计划
                for (let i = 0; i < samplePlan.totalDays; i++) {
                    const date = new Date(samplePlan.startDate);
                    date.setDate(date.getDate() + i);
                    
                    const dayNumber = (i % samplePlan.cycleDays) + 1;
                    const cycleNumber = Math.floor(i / samplePlan.cycleDays) + 1;
                    
                    samplePlan.dailyPlans.push({
                        id: `day_${i + 1}`,
                        date: date.toISOString().split('T')[0],
                        dayNumber: dayNumber,
                        cycleNumber: cycleNumber,
                        name: `第${cycleNumber}周期 - 第${dayNumber}天`,
                        targets: { ...samplePlan.defaultTargets },
                        meals: {
                            breakfast: [],
                            lunch: [],
                            dinner: [],
                            snacks: []
                        },
                        isCompleted: i < 3, // 前3天标记为已完成
                        isConfigured: i < 5  // 前5天标记为已配置
                    });
                }
                
                // 添加一些示例食物
                samplePlan.dailyPlans[0].meals.breakfast = [
                    { name: '燕麦片', unit: 'g', quantity: 50, calories: 180, protein: 6, fat: 3, carbs: 30 },
                    { name: '牛奶', unit: 'ml', quantity: 250, calories: 150, protein: 8, fat: 8, carbs: 12 }
                ];
                
                samplePlan.dailyPlans[0].meals.lunch = [
                    { name: '鸡胸肉', unit: 'g', quantity: 150, calories: 250, protein: 46, fat: 5, carbs: 0 },
                    { name: '糙米饭', unit: 'g', quantity: 100, calories: 180, protein: 2.6, fat: 0.9, carbs: 22.9 }
                ];
                
                // 保存到本地存储
                let plans = JSON.parse(localStorage.getItem('dietPlans') || '[]');
                plans.push(samplePlan);
                localStorage.setItem('dietPlans', JSON.stringify(plans));
                localStorage.setItem('activePlanId', samplePlan.id);
                
                addTestResult('示例数据生成成功！', 'success');
                addTestResult(`计划ID: ${samplePlan.id}`, 'info');
            } catch (error) {
                addTestResult(`生成失败: ${error.message}`, 'error');
            }
        }

        function clearAllData() {
            if (confirm('确定要清除所有数据吗？此操作不可恢复。')) {
                localStorage.removeItem('dietPlans');
                localStorage.removeItem('activePlanId');
                clearResults();
                addTestResult('所有数据已清除', 'success');
            }
        }
    </script>
</body>
</html>