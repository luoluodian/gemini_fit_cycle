# 饮食计划小程序需求文档

## 文档版本
v1.0 (Based on Business Logic v1.0)

## 1. 产品概述
本产品是一款移动端饮食记录与管理小程序，旨在帮助用户科学管理日常饮食、制定个性化饮食计划、追踪营养摄入。核心价值在于提供从计划制定到每日记录的闭环体验，支持普通饮食与碳循环等进阶饮食策略。

## 2. 用户角色
- **普通用户**: 需要记录日常饮食，关注热量和基础营养素摄入。
- **进阶用户**: 有明确的减脂/增肌目标，需要执行如碳循环等特定饮食计划，对营养素比例有精确要求。

## 3. 功能需求

### 3.1 登录与账户体系
*   **登录方式**:
    *   微信一键登录：获取用户昵称、头像。
    *   免登录体验模式：允许用户在不授权的情况下试用核心功能，但数据仅保存在本地，不进行云端同步（当前版本全量本地存储）。
*   **隐私保护**:
    *   首次进入显示隐私政策入口。
    *   明确告知用户数据存储方式（本地存储）及收集范围。
*   **状态保持**:
    *   自动记录登录状态，二次进入直接跳转主页。
    *   支持退出登录或清除本地数据。

### 3.2 计划管理 (核心)
*   **计划列表**:
    *   区分“进行中”与“已完成”的计划。
    *   展示计划关键信息：名称、类型（减脂/增肌/维持）、剩余天数、每日热量目标、当前进度百分比。
    *   支持导入计划（通过分享码）。
*   **推荐计划**:
    *   提供系统预设的经典计划模板（如：30天减脂挑战、增肌训练、均衡营养）。
    *   支持用户直接基于推荐模板创建个人计划，简化配置流程。
*   **创建计划**:
    *   **基础设置**: 输入计划名称，选择类型（普通/碳循环），设置周期参数（每周期天数、周期数量）。
    *   **碳循环配置** (进阶): 针对碳循环类型，支持设置高/中/低碳日的营养素比例和天数分配。
    *   **日模板配置**:
        *   支持为周期内的每一天配置独立的营养目标（热量、蛋白质、脂肪、碳水）。
        *   支持为每一天预设餐单（早餐、午餐、晚餐、加餐的具体食物）。
        *   提供模板复制、删除、拖拽排序功能。
        *   支持“一键补满周期”功能，快速生成重复的日计划。
*   **计划执行**:
    *   激活计划：同一时间只能有一个激活的计划。
    *   自动计算：根据计划开始日期，自动计算当前处于周期的第几天，并匹配对应的日模板。

### 3.3 饮食记录 (主页)
*   **日期导航**: 支持切换日期查看历史记录或补录。
*   **今日概览**:
    *   实时显示今日目标热量 vs 已摄入热量。
    *   展示三大营养素（蛋白质、脂肪、碳水）的进度条和具体数值。
*   **餐次记录**:
    *   分为早餐、午餐、晚餐、加餐四个餐次。
    *   **手动添加**: 从食材库选择食物，输入数量（支持多种单位）添加。
    *   **按计划记录**: 若当前有激活计划且对应日模板有预设餐单，支持一键将预设食物加入记录。
    *   支持对已记录食物进行编辑（数量）或删除。
*   **实时反馈**:
    *   每次记录后自动更新今日摄入总量和进度条。

### 3.4 食材库管理
*   **食材分类**: 提供多维度分类（蛋白质、蔬菜、水果、主食等）便于查找。
*   **热门/常用**: 首页展示热门或最近使用的食材，支持快速添加。
*   **搜索功能**: 支持按名称实时搜索食材。
*   **食材详情**: 展示热量及三大营养素含量（每100g/ml标准）。
*   **自定义食材**:
    *   用户可创建私有食材，输入名称、热量及营养素数据。
    *   支持设置自定义食材的分类和单位。
*   **收藏功能**: 支持收藏常用食材，在选择时置顶显示。

### 3.5 个人中心与工具
*   **用户档案**: 展示头像、昵称及坚持天数统计。
*   **健康工具**:
    *   **BMR/TDEE计算器**: 根据身高、体重、年龄、性别、活动量计算基础代谢和每日消耗，并给出不同目标下的热量建议。
    *   **体重记录**: 记录并追踪体重变化趋势。
    *   **营养指南**: 提供基础营养知识和饮食建议。
*   **数据统计**: 展示本周热量摄入趋势图表（目标线 vs 实际摄入线）。
*   **系统设置**:
    *   **应用设置**: 通知、隐私、数据管理。
    *   **帮助与反馈**: 使用教程、问题反馈。
    *   **关于**: 版本信息、功能介绍。

## 4. 业务规则与逻辑

### 4.1 计划与周期逻辑
1.  **周期循环**: 计划由 $N$ 个周期组成，每个周期 $M$ 天。计划总天数 = $N \times M$。
2.  **模板匹配**:
    *   设计划开始日期为 $D_{start}$，当前日期为 $D_{now}$。
    *   已进行天数 $Days = D_{now} - D_{start} + 1$。
    *   当前周期数 = $ceil(Days / M)$。
    *   当前周期内第几天 = $(Days - 1) \% M + 1$。
    *   系统根据“周期内第几天”读取对应的日模板配置。

### 4.2 营养计算规则
1.  **基础单位**: 所有食材的营养数据均标准化为每 **100g** (或 100ml) 的数值。
2.  **摄入计算**:
    $$摄入量 = \frac{食材标准值}{100} \times 摄入数量$$ 
3.  **汇总逻辑**:
    *   餐次摄入 = $\sum$ (餐次内所有食物摄入量)
    *   单日摄入 = $\sum$ (所有餐次摄入量)

### 4.3 数据一致性要求
1.  **单一数据源**: 无论是“食材库”、“计划预设”还是“每日记录”，所引用的食物数据必须来源统一，确保营养数据的一致性。自定义食材创建后应立即可在所有模块被搜索和使用。
2.  **计划快照**: 计划一旦创建并激活，其包含的日模板数据应被视为“快照”。后续修改模板不应影响历史已完成的记录，但应即时应用到未来的日期。

## 5. 非功能需求
*   **响应式布局**: 适配主流移动端设备屏幕尺寸。
*   **数据持久化**: 核心业务数据（计划、记录、自定义食材）需在本地持久化存储，避免刷新丢失。
*   **交互体验**:
    *   关键操作（如删除、完成计划）需有二次确认。
    *   数据加载和提交需有加载状态提示。
    *   成功操作需有 Toast 提示。

## 6. 附录：数据字典
*   **Plan**: { id, name, type, startDate, cycleDays, cycleCount, dayTemplates[] }
*   **DayTemplate**: { dayNumber, target: {calories, ...}, meals: {breakfast: [], ...} }
*   **Food**: { id, name, unit, calories, protein, fat, carbs, category }
*   **Record**: { date, meals: { ... } }
