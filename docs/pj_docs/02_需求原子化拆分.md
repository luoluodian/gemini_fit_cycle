# 02_需求原子化拆分

> **说明**: 本文档将系统需求拆解为可独立执行的原子开发任务。
> **优先级定义**: P0 (MVP核心阻断性功能), P1 (重要功能), P2 (体验优化/非核心)。

## 1. 用户域 (User Domain) - 9 Tasks

| ID | 任务名称 | 端 | 类型 | P | 依赖 | 描述 |
|:---|:---|:---|:---|:---|:---|:---|
| **U-1** | 微信登录接口 | 后端 | API | **P0** | - | 实现 `auth/login` 接口，对接微信 Session，发放 JWT。 |
| **U-2** | 认证服务封装 | 前端 | Service | **P0** | U-1 | 封装 `wx.login`，自动处理 Token 存储与拦截器注入。 |
| **U-3** | 登录页面 UI | 前端 | Page | **P0** | U-2 | 实现登录页布局、授权按钮交互及隐私协议弹窗。 |
| **U-4** | 用户信息接口 | 后端 | API | **P0** | U-1 | `user/profile` 的 GET/PUT 接口，支持更新基本信息。 |
| **U-5** | 个人中心页 UI | 前端 | Page | **P0** | U-4 | 展示头像、昵称、坚持天数，提供功能入口。 |
| **U-6** | BMR 计算逻辑 | 后端 | Logic | **P1** | - | 封装 Mifflin-St Jeor 公式计算服务。 |
| **U-7** | 健康档案接口 | 后端 | API | **P1** | U-6 | 存储用户的身高、体重、活动系数，返回计算结果。 |
| **U-8** | 健康工具 UI | 前端 | Comp | **P1** | U-7 | BMR 计算器弹窗及结果展示组件。 |
| **U-9** | User 实体定义 | 后端 | DB | **P0** | - | 定义 User 与 HealthProfile 的 TypeORM 实体。 |
| **U-10** | 体重记录接口 | 后端 | API | **P1** | U-9 | 实现体重的增删改查及历史趋势查询接口。 |
| **U-11** | 体重管理 UI | 前端 | Page | **P1** | U-10 | 个人中心的体重记录弹窗及 ECharts 趋势图。 |
| **U-12** | 营养指南页面 | 前端 | Page | **P2** | - | 实现个人中心内的静态营养知识指南页面。 |

## 2. 食材域 (Food Domain) - 8 Tasks

| ID | 任务名称 | 端 | 类型 | P | 依赖 | 描述 |
|:---|:---|:---|:---|:---|:---|:---|
| **F-1** | 系统食材导入 | 后端 | Script | **P0** | - | 编写脚本将基础食材库（JSON）导入 MySQL。 |
| **F-2** | 食材搜索接口 | 后端 | API | **P0** | F-1 | `food/search` 接口，支持模糊匹配与分类筛选。 |
| **F-3** | 食材详情接口 | 后端 | API | **P0** | F-1 | `food/:id` 接口，返回详细营养素。 |
| **F-4** | Food 实体定义 | 后端 | DB | **P0** | - | 定义 FoodItem 实体，区分系统/自定义类型。 |
| **F-5** | 自定义食材 API | 后端 | API | **P1** | F-4 | `food/custom` 的 POST/DELETE 接口。 |
| **F-6** | 食材库页面 UI | 前端 | Page | **P1** | F-2 | 实现分类 Tab、热门推荐及列表渲染。 |
| **F-7** | 食材搜索组件 | 前端 | Comp | **P0** | F-2 | 封装可复用的食材搜索下拉/弹窗组件。 |
| **F-8** | 创建食材 UI | 前端 | Page | **P1** | F-5 | 自定义食材的表单页面。 |
| **F-9** | 食材收藏接口 | 后端 | API | **P1** | F-4 | 实现食材的收藏与取消收藏功能。 |
| **F-10** | 热门食材接口 | 后端 | API | **P1** | F-1 | 实现 `food/popular` 接口，返回系统推荐或高频食材。 |

## 3. 计划域 (Plan Domain) - 14 Tasks

| ID | 任务名称 | 端 | 类型 | P | 依赖 | 描述 |
|:---|:---|:---|:---|:---|:---|:---|
| **P-1** | Plan 实体设计 | 后端 | DB | **P0** | - | 定义 DietPlan, Cycle, PlanTemplate 实体及关联。 |
| **P-2** | 计划 CRUD 接口 | 后端 | API | **P0** | P-1 | 计划的基础增删改查接口。 |
| **P-3** | 模板管理接口 | 后端 | API | **P0** | P-1 | 日模板的配置接口（含餐单关联）。 |
| **P-4** | 计划状态管理 | 后端 | Logic | **P0** | P-2 | 处理激活/暂停逻辑，确保单一激活原则。 |
| **P-5** | 计划列表 UI | 前端 | Page | **P0** | P-2 | 展示进行中和历史计划列表。 |
| **P-6** | 创建向导 UI | 前端 | Page | **P0** | P-2 | 分步表单：基础信息 -> 周期设置。 |
| **P-7** | 碳循环计算器 | 前端 | Logic | **P1** | - | 前端实现的碳循环参数计算逻辑（复用原型代码）。 |
| **P-8** | 碳循环配置 UI | 前端 | Comp | **P1** | P-7 | 高/中/低碳日参数配置组件。 |
| **P-9** | 模板编辑 UI | 前端 | Page | **P0** | P-3 | 日模板的详细配置页（目标+餐单）。 |
| **P-10** | 一键补满逻辑 | 后端 | Logic | **P1** | P-3 | 后端实现通过少量模板生成完整周期的逻辑。 |
| **P-11** | 推荐计划种子 | 后端 | Data | **P1** | - | 预设 3 个官方推荐计划数据。 |
| **P-12** | 推荐计划 API | 后端 | API | **P1** | P-11 | 获取推荐计划列表及详情。 |
| **P-13** | 计划详情页 UI | 前端 | Page | **P1** | P-5 | 展示计划概览及每日安排视图。 |
| **P-14** | 计划分享接口 | 后端 | API | **P2** | - | 生成及解析计划分享码。 |
| **P-15** | 推荐计划种子 | 后端 | Data | **P1** | P-1 | 初始化系统预设的推荐计划数据。 |

## 4. 记录域 (Record Domain) - 8 Tasks

| ID | 任务名称 | 端 | 类型 | P | 依赖 | 描述 |
|:---|:---|:---|:---|:---|:---|:---|
| **R-1** | Record 实体设计| 后端 | DB | **P0** | - | 定义 DailyRecord 及 MealLog 实体。 |
| **R-2** | 每日记录接口 | 后端 | API | **P0** | R-1 | 获取/创建指定日期的记录。 |
| **R-3** | 餐次操作接口 | 后端 | API | **P0** | R-1 | 向指定餐次添加/删除/更新食物。 |
| **R-4** | 首页仪表盘 UI | 前端 | Page | **P0** | R-2 | 首页框架，日期导航，目标进度条。 |
| **R-5** | 餐次卡片组件 | 前端 | Comp | **P0** | R-3 | 展示单餐食物列表，提供添加/编辑入口。 |
| **R-6** | 快捷添加逻辑 | 后端 | Logic | **P1** | P-3 | "按计划记录"的后端实现：从 Template 复制到 Record。 |
| **R-7** | 数量键盘组件 | 前端 | Comp | **P0** | - | 专用的数字输入键盘，支持单位切换。 |
| **R-8** | 营养统计计算 | 前端 | Logic | **P0** | - | 前端实时计算今日已摄入总量。 |

## 5. 分析域 (Analysis Domain) - 4 Tasks

| ID | 任务名称 | 端 | 类型 | P | 依赖 | 描述 |
|:---|:---|:---|:---|:---|:---|:---|
| **A-1** | 周统计接口 | 后端 | API | **P1** | R-1 | 实现 `/analysis/weekly` 接口，聚合查询过去 7 天的摄入数据。 |
| **A-2** | 趋势图表组件 | 前端 | Comp | **P1** | A-1 | 使用 ECharts 封装热量/体重趋势图。 |
| **A-3** | 达标率分析 | 后端 | Logic | **P2** | A-1 | 计算计划执行的达标天数比例。 |
| **A-4** | 数据导出功能 | 前端 | Feature| **P2** | - | 导出记录为图片或 Excel（需后端支持）。 |

---

## 统计总结
- **Total Tasks**: 49
- **P0 Tasks**: 25
- **P1 Tasks**: 20
- **P2 Tasks**: 4
