# F-4: Food 实体定义 - T5 分析文档

> **任务 ID**: F-4  
> **任务名称**: Food 实体定义  
> **优先级**: P0  
> **垂直拆分**: 后端 DB  
> **预估工时**: 1h  
> **复杂度**: 低  
> **分析时间**: 2026-01-31  
> **分析人**: AI Assistant

---

## 5.1 模块关联性审计

### 涉及公共数据表
- [x] `food_items`: 核心实体表。

### 所有关联模块
- `Food Domain`: 基础数据结构。
- `DietPlan`: 计划中的食物引用。
- `DietLog`: 每日饮食记录中的食物引用。

---

## 5.2 影响评估

### 需要修改的现有文件
- [x] `fit_cycle_app/src/database/entity/food-item.entity.ts`: 验证字段完整性。

### 对现有功能的影响
- [x] **无影响**: 实体已在 F-1 任务中预先重构完成，本次任务为正式的合规性确认。

---

## 5.3 技术落地计划

### 1. 实体结构确认 (对齐 04 规约)

- **表名**: `food_items`
- **主键**: `id` (BigInt, Unsigned)
- **核心字段**:
    - `name`: 字符串，必填，带索引。
    - `type`: 枚举 (`system`, `custom`)，区分系统预设和用户创建。
    - `userId`: 关联用户 ID（系统食材为 NULL）。
    - `category`: 枚举（蛋白质、蔬菜等）。
    - `calories`: 整数，每 100g 热量。
    - `protein`, `fat`, `carbs`: Decimal(8,2)，宏量元素。
    - `unit`: 字符串，默认单位。
    - `isPublic`: 布尔值，是否公开可见。
- **审计字段**: `createdAt`, `updatedAt`, `deletedAt` (支持软删除)。

### 2. 关联关系
- `ManyToOne` -> `User`: 指向创建者。

### 3. 数据流向
```
TypeORM Entity -> Database Schema
```

### 4. 依赖任务检查
- [x] 依赖任务 `S-1` (数据库初始化) 已完成。

---

## 5.4 风险点清单

- [x] **数据精度**: 已确认使用 `decimal(8,2)` 处理营养素，避免浮点误差。
- [x] **唯一性**: 虽然允许重名（不同用户可能创建同名食材），但系统食材应通过后台逻辑保证名称唯一。

---

## 5.5 预期交付物

### 代码交付物
- `fit_cycle_app/src/database/entity/food-item.entity.ts` (正式基准化)

### 文档交付物
- T6~T9 全套文档。

---

## 5.6 自检清单
- [x] 实体字段完全匹配规约
- [x] 索引配置合理
- [x] 支持软删除
- [x] 枚举定义清晰

---

## 5.7 下一步行动
1. **立即执行**: 进入 T6 阶段，确立代码基准。
