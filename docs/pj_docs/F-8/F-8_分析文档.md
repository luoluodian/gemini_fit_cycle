# F-8: 创建食材 UI - T5 分析文档

> **任务 ID**: F-8  
> **任务名称**: 创建食材 UI  
> **优先级**: P1  
> **垂直拆分**: 前端 Component / Page  
> **预估工时**: 4h  
> **复杂度**: 中  
> **分析时间**: 2026-01-31  
> **分析人**: AI Assistant

---

## 5.1 模块关联性审计

### 涉及公共组件
- [x] `BaseModal.vue`: 底层弹窗。
- [x] `BaseButton.vue`: 统一按钮。
- [x] `CustomFoodModal.vue`: 已有初步实现，需大幅增强。

### 涉及跨模块 Service
- `FoodService` (`fit_cycle_web/src/services/modules/food.ts`): 需要新增 `createFoodItem` 和 `updateFoodItem` 方法。

### UI 结构分析 (参考 html/food.html)
- **表单内容**:
    - 名称 (Input)
    - 单位 (Picker: g, ml, piece, etc.)
    - 图标选择 (Emoji Grid)
    - 分类标签 (Multiple Selection Grid with colors)
    - 营养素输入 (Calories, P, F, C - styled in a grid)
    - 描述 (Textarea)
    - 公开开关 (Switch)
- **视觉特征**:
    - 营养素区域采用渐变背景 (`from-emerald-50 to-teal-50`)。
    - 标签按钮带不同的背景和文字颜色。
    - 整体风格延续卡片流。

---

## 5.2 影响评估

### 需要修改的现有文件
- [x] `fit_cycle_web/src/components/food/CustomFoodModal.vue`: 
    - 增强 UI：添加 Emoji 选择、标签选择、公开开关。
    - 增强逻辑：对接 API，处理错误状态。
- [x] `fit_cycle_web/src/services/modules/food.ts`:
    - 新增 `createFoodItem` 和 `updateFoodItem` 封装。

---

## 5.3 技术落地计划

### 1. 接口扩展 (Food Service)

```typescript
export async function createFoodItem(data: Partial<FoodItem>): Promise<FoodItem> {
  return httpRequest.post("/food-items", data);
}

export async function updateFoodItem(id: number | string, data: Partial<FoodItem>): Promise<FoodItem> {
  return httpRequest.put(`/food-items/${id}`, data);
}
```

### 2. 组件增强逻辑

- **数据回显**: 完善 `editingFood` 传入时的字段映射。
- **验证**: 提交前检查 `name` 和 `calories` 必填。
- **提交**: 
    - 提交后自动刷新父页面列表（通过 `emit('submit')`）。
    - 成功后显示 Toast 提示。

### 3. UI 还原重点

- **Emoji 选择**: 预设 8-12 个常用 Emoji。
- **分类标签**: 对齐 `FoodCategory` 枚举，并赋予特定的颜色类。

### 4. 依赖任务检查

- [x] 依赖任务 `F-5` (后端 API) 已完成。

---

## 5.4 风险点清单

- [ ] **表单重置**: 确保关闭弹窗后状态被彻底重置，避免下次打开残留旧数据。
- [ ] **性能**: Picker 和大量的 Icon 按钮在低端机上的渲染。

---

## 5.5 预期交付物

### 代码交付物
- `fit_cycle_web/src/components/food/CustomFoodModal.vue` (增强版)
- `fit_cycle_web/src/services/modules/food.ts` (API 封装)

### 文档交付物
- T6~T9 全套文档。

---

## 5.6 自检清单
- [x] 视觉 100% 还原 prototype
- [x] 支持编辑模式
- [x] 错误处理与验证
- [x] API 同步成功

---

## 5.7 下一步行动
1. **立即执行**: 修改 `food.ts` 补全 API。
2. **立即执行**: 重构 `CustomFoodModal.vue`。
