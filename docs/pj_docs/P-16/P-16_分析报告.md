# P-16 & P-18: 创建向导 Step 2 - 周期列表展示与交互 分析报告

> **任务 ID**: P-16 & P-18  
> **任务名称**: 周期列表展示与交互管理（排序/复制/删除）  
> **优先级**: P0/P1  
> **垂直拆分**: 前端组件 + 状态管理  
> **复杂度**: 中  
> **分析时间**: 2026-02-04 17:00  
> **分析人**: AI Assistant

---

## 1. 业务目标
在计划创建流程的第二步，为用户提供一个直观、易操作的周期预览界面。用户可以清晰看到每一天的营养目标分布（特别是在碳循环模式下），并能通过简单的交互调整天数顺序、复制典型配置或删除多余天数。

## 2. 原型对比与优化 (UI Analysis)
参考 `html/plan-templates.html` 及前期用户反馈：

### 2.1 视觉对齐 (Visual Alignment)
- **卡片配色**: 严格遵循碳循环阶段色（高碳：黄，中碳：绿，低碳：蓝）。
- **全中文显示**: 
  - `Day 1` -> `第 1 天`
  - `Cycle 1` -> `第 1 周期`
  - `xx items` -> `xx 个食物`
- **移除冗余**: 按照用户要求，移除左侧拖拽手柄图标，释放空间。

### 2.2 交互增强 (Interaction)
- **排序功能**: 考虑到移动端操作的稳健性，不再使用复杂的长按拖拽，改为在操作区增加“上移/下移”按钮。
  - **首行**: 仅显示“下移”。
  - **末行**: 仅显示“上移”。
  - **中间行**: 显示“上移”和“下移”。
- **复制与删除**: 保持现有逻辑，但优化图标间距与点击热区。

---

## 3. 技术落地方案

### 3.1 状态管理 (`PlanStore`)
增加排序相关的 Action：
- `reorderTemplate(oldIndex, newIndex)`: 交换数组元素位置。

### 3.2 组件重构 (`TemplateManagementStep.vue`)
- **列表项结构**:
  - `flex-1`: 展示 `第 X 天`、阶段标签、营养目标概览。
  - `flex-shrink-0`: 展示操作按钮组。
- **动态样式**: 使用 `getPhaseStyles` 映射颜色和图标。

### 3.3 逻辑闭环 (Logic Flow)
1.  **初始化**: 进入页面时，从 `planStore.draft.templates` 加载数据。
2.  **排序**: 点击上移 -> `index` 与 `index - 1` 交换 -> 触发计算属性 `highDays/mediumDays/lowDays` 重新统计。
3.  **保存**: 确认计划时，按当前数组顺序提交至后端。

---

## 4. 风险点清单

- **天数索引错乱**: 排序后需要重新计算 `Day X` 的显示文字（应始终基于当前数组 `index + 1`）。
- **碳循环分布偏差**: 排序可能破坏原有的碳循环规律（如：高-高-中-中...），需在顶部摘要中实时反映当前各阶段的总天数，提醒用户检查平衡性。

---

## 5. 交付物
- `src/components/plan-creator/TemplateManagementStep.vue` (更新)
- `src/stores/plan.ts` (增加排序方法)

---

**下一步**: 进入 T6 编码阶段。
