# T5 分析文档: R-5 餐次卡片组件 (Meal Card Component)

## 1. 任务背景 (Task Background)
任务 **R-5** 旨在完成首页餐次卡片的细节开发。该组件是用户交互最频繁的单元，负责展示单餐的摄入明细、热量汇总，并提供打卡/编辑/删除的完整入口。

## 2. 契约与数据结构分析 (Contract Alignment)

### 2.1 Props 结构重构
- **现状**: 使用旧版 `MealRecord` (含 `meal_type_label`, `details` 等)。
- **目标**: 对齐 `services/modules/record.ts` 中的 `MealLog` 实体。
    ```typescript
    interface Props {
      title: string;      // 显式传入标题 (如 "早餐")
      mealType: string;   // breakfast | lunch ...
      meals: MealLog[];   // 真实的明细数组
    }
    ```

### 2.2 子组件对接
- **FoodItemAdapter**: 负责单行食物的渲染。需确保其 Props 接受 `MealLog` 实体字段（如 `foodName`, `quantity`, `calories`）。

## 3. 核心功能实现 (Core Features)

### 3.1 热量汇总逻辑
- **逻辑**: 组件内通过计算属性 `totalCalories` 对 `props.meals` 进行 `reduce` 求和。
- **精度**: 结果需执行 `Math.round()`，保持与进度环的一致性。

### 3.2 交互闭环 (Interactions)
- **添加 (Add)**: 点击“添加食物” -> 向上冒泡 `add` 事件，带上 `mealType`。
- **删除 (Delete)**: 
    - 触发 `handleDeleteFood`。
    - 调用 `removeMealLog(id)` (R-3 接口)。
    - **UI 反馈**: 删除后需触发父组件（首页）刷新数据流。
- **编辑 (Edit)**: 预留 `edit` 事件入口，后续对接 R-3 的 PUT 接口。

## 4. 样式与状态设计 (UI/UX)
- **空状态 (Empty State)**: 当 `meals.length === 0` 时，展示“暂无记录”提示，并保持“添加食物”按钮可见。
- **加载状态**: 配合首页的 `isLoading` 状态，组件内部支持骨架屏占位。

## 5. 潜在风险与对策 (Risks & Mitigations)
- **事件穿透**: 确保删除按钮点击时不会触发卡片的展开/折叠（如果有）。
- **同步延迟**: 删除操作成功后，前端应立即在本地数组中剔除该项（乐观更新）或触发全局重载，防止 UI 闪烁。

## 6. 结论 (Conclusion)
R-5 的关键在于**契约的彻底切换**。通过将组件与后端实体 `MealLog` 强绑定，实现了从首页到详情页的数据模型闭环。
