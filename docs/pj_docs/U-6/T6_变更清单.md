# U-6: BMR 计算逻辑 - T6 变更清单

> **变更日期**: 2026-01-31  
> **执行人**: AI Assistant

---

## 1. 变更摘要

本次任务通过对 `UserService` 中的健康指标计算逻辑进行规范化确认，正式确立 Mifflin-St Jeor 公式及其关联的 TDEE 计算为项目的逻辑基准。

## 2. 文件变更列表

### 确认/微调文件

| 文件路径 | 状态 | 简要说明 |
|:---|:---|:---|
| `fit_cycle_app/src/modules/user/user.service.ts` | 确认 | 确立 `calculateHealthMetrics` 私有方法作为核心逻辑入口。 |

## 3. 详细变更内容

### 3.1 `UserService` 逻辑确认

- [x] **公式实现**: 实现并验证了 Mifflin-St Jeor 公式。
  - 男: $10w + 6.25h - 5a + 5$
  - 女: $10w + 6.25h - 5a - 161$
- [x] **精度处理**: 使用 `Number()` 转换 TypeORM 的 `decimal` 字段，确保浮点数计算不降级为字符串拼接。
- [x] **取整逻辑**: 使用 `Math.round()` 对 BMR 和 TDEE 进行四舍五入取整，符合 UI 展示要求。
- [x] **兜底逻辑**: 为活动系数提供了 `1.2` (久坐) 的默认值。

## 4. 验证计划

1.  **静态检查**: 确认逻辑分支覆盖了 `male` 和 `female` 两种性别场景。
2.  **构建验证**: 运行 `npm run build` 确保无类型冲突。
3.  **单元测试**: (将在 T7 阶段执行) 针对不同输入值验证计算结果的准确性。
