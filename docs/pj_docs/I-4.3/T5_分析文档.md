# T5 分析文档: I-4.3 历史回溯联调 (History & Preview Backtracking) - V2 增强版

## 1. 任务背景 (Task Background)
任务 **I-4.3** 验收记录域在时间轴维度的确定性。本版本重点引入了“本地优先预览”机制，并解决了计划大幅变更后历史快照的“自愈/强制重刷”需求。

## 2. 状态机与性能优化

### 2.1 本地优先缓存 (State Persistence Cache)
- **策略**: 在 `recordStore` 中建立 `memoryCache`。
- **逻辑**: 日期切换时，先展示内存中的旧记录（如有），同时发起静默网络请求。
- **目的**: 实现极速回溯体验，消除切换日期时的频繁 Loading 感。

### 2.2 强制刷新快照 (Snapshot Reforce)
- **场景**: 用户修改了计划，希望将“已录入过食物”的今日热量目标从旧计划 A 刷新为新计划 B。
- **动作**: 预留 `refreshSnapshotTarget` 接口，允许根据最新计划重写 `DailyRecord` 的 `target_` 具名列。

## 3. 联调关键场景补全
- **跨月/跨年边界**: 验证 2 月 28 日切换至 3 月 1 日的偏移算法稳定性。
- **零时区防御**: 验证 00:05 分时的“今天”定义是否随系统时间动态漂移。

## 4. 结论
V2 版 T5 不仅保证了数据的抗漂移性，更通过缓存策略极大提升了回溯历史的顺滑感。