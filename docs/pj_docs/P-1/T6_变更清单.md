# P-1: Plan 实体设计 - T6 变更清单

> **任务 ID**: P-1  
> **任务状态**: 已完成编码与 DB 同步

---

## 6.1 代码变更详情

### 后端 (fit_cycle_app)

#### 1. 实体重构: `DietPlan` (`src/database/entity/diet-plan.entity.ts`)
- [x] **新增枚举**: `PlanType` (含 `carb-cycle`), `PlanStatus` (含 `active`, `draft`)。
- [x] **字段对齐**:
  - `goalType` -> `type` (Enum)。
  - `status` -> `PlanStatus` (Enum)。
  - 新增 `isTemplate` (Boolean): 区分官方模板。
  - 新增 `cycleDays` (Int): 一个周期的天数。
  - 新增 `cycleCount` (Int): 周期重复次数。
  - 新增 `startDate` (Date): 计划开始时间。
  - 新增 `carbCycleConfig` (JSON): 碳循环参数快照。
  - 修正营养素字段类型为 `decimal` (Protein, Fat, Carbs) 及 `int` (Calories)。

#### 2. 实体重构: `PlanDay` (`src/database/entity/plan-day.entity.ts`)
- [x] **移除字段**: `date` (该实体作为计划模板的天数配置，不应绑定具体日期)。
- [x] **重命名字段**: `dayIndex` -> `dayNumber`。
- [x] **新增字段**: `carbType` (String): 标识该天是高/中/低碳。
- [x] **字段对齐**: 同步更新营养素字段为 `decimal`。

---

## 6.2 数据库变更 (Schema Sync)

- [x] **同步执行**: 已通过 `DataSource.synchronize(true)` 完成表结构更新。
- [x] **变更影响**: 现有 `diet_plans` 和 `plan_days` 表中的旧字段将被移除，新字段已按 `04_接口与数据规约.md` 创建。

---

## 6.3 验证状态

- [x] **编译检查**: `npm run build` 通过。
- [x] **DB 连接**: 成功连接并完成 Schema 同步。

---

## 6.4 待办事项 (Next Steps)

1. **进入 P-2**: 开始开发计划 CRUD 接口，需确保 DTO 同步更新以适配新的实体字段名。
2. **种子数据**: 在 `P-11` 中需根据新实体结构预设推荐计划。
