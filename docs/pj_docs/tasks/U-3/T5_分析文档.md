# U-3: 登录 UI - T5 分析文档

## 5.1 模块关联性审计

- **涉及公共 Store**: `useUserStore` (Pinia)
- **涉及公共组件**:
  - `LogoHeader.vue` (已存在)
  - `WelcomeCard.vue` (已存在)
  - `LoginButton.vue` (已存在)
  - `PrivacyModal.vue` (已存在)
  - `ErrorMessage.vue` (通用错误提示)
- **涉及跨模块 Service**:
  - `fit_cycle_web/src/services/modules/auth.ts`: 登录接口
- **涉及外部依赖**:
  - `animejs`: 动画库 (参考 html/login.js 中的使用)
  - `NutUI`: UI 组件库 (按需使用)

## 5.2 影响评估

- **需要修改的现有文件**:
  - `fit_cycle_web/src/pages/login/index.vue`: 主页面逻辑，需要整合现有组件并完善交互。
  - `fit_cycle_web/src/pages/login/index.scss`: 样式文件，需适配 Tailwind 和 Sass。
- **对现有功能的影响**: 登录页是 App 入口，直接影响用户首次体验。
- **必须参考的文件路径**:
  - `html/login.html`: 原型 HTML 结构
  - `html/login.js`: 原型交互逻辑 (动画、事件)
  - `docs/pj_docs/04_接口与数据规约.md`: 确认接口调用方式

## 5.3 技术落地计划

### 1. 核心任务定义
- **UI 还原**: 将 `html/login.html` 的视觉效果迁移至 Vue 组件。
- **动画实现**: 使用 `animejs` 或 CSS 动画还原 `html/login.js` 中的入场动画。
- **交互逻辑**:
  - 微信登录：调用 `Taro.login` -> 后端 `/auth/wechatAuth`。
  - 免登录体验：设置本地标记 -> 跳转首页。
  - 隐私政策：弹窗展示。
- **状态管理**: 登录成功后更新 `useUserStore`。

### 2. 实现逻辑
1. **组件整合**: 在 `index.vue` 中组装 `LogoHeader`, `WelcomeCard`, `LoginButton`, `PrivacyModal`。
2. **样式迁移**: 将 `html/login.html` 中的内联样式和 Tailwind 类转换为 Vue 组件样式。
3. **逻辑绑定**:
   - `LoginButton` 点击事件 -> `handleLogin`。
   - `handleLogin`: `Taro.login()` 获取 code -> `authService.login(code)` -> `userStore.setLoginState()` -> 跳转首页。
   - `tryWithoutLogin`: 记录 `demoMode` -> 跳转首页。

### 3. 风险点
- **Taro 兼容性**: 原型中使用 `window` 对象和 DOM 操作 (如 `document.getElementById`)，在小程序环境中需改为 Vue 数据驱动或 Taro API。
- **动画性能**: 确保动画在小程序端流畅运行。

## 5.4 验收标准 (T7 预案)
- [ ] 页面加载时有元素的入场动画。
- [ ] 点击“微信一键登录”能成功调用微信登录流程并跳转首页。
- [ ] 点击“先体验一下”能跳转首页且不报错。
- [ ] 点击“隐私政策”能弹出模态框，点击关闭能隐藏。
- [ ] 登录失败时有明确的错误提示。