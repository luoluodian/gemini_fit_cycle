# U-5: 路由守卫 - T6 变更清单

## 6.1 修改文件

- `fit_cycle_web/src/constants/routes.ts`:
    - 添加了 `PUBLIC_PAGES` 白名单，目前仅包含登录页。
    - 添加了 `isPublicPage` 工具函数，用于判断路径是否需要权限。
- `fit_cycle_web/src/router/index.ts`:
    - 实现了 `beforeNavigate` 守卫，接入 `useUserStore` 检查登录状态。
    - 拦截并重构了 `navigateTo`, `redirectTo`, `switchTab`, `reLaunch`。
    - 未登录用户访问受保护页面时，强制重定向至登录页并携带 `redirect` 参数。
- `fit_cycle_web/src/app.ts`:
    - 使用 `useLaunch` 钩子实现了应用启动时的权限自检。
    - 确保用户直接通过 Scheme 或扫码进入受保护页面时能被正确拦截。
- `fit_cycle_web/src/pages/login/index.vue`:
    - 接入 `useRouterParams` 获取 `redirect` 参数。
    - 登录成功或进入游客模式后，优先跳转至 `redirect` 指定的页面。

## 6.2 完整性检查结果

### 【导入语句检查】
- [x] 所有导入的模块都已安装？
- [x] 所有导入的文件路径都正确？
- [x] 所有导入的类/函数都存在？

### 【类型定义检查】
- [x] TypeScript 编译通过？ (`npm run build:weapp` 成功)

### 【交互逻辑检查】
- [x] 启动拦截逻辑正确？ (已验证 `useLaunch`)
- [x] 编程式导航拦截正确？ (已封装 `router/index.ts`)
- [x] 登录回跳逻辑正确？ (已接入 `redirect` 处理)

### 【构建验证】
- [x] `npm run build:weapp` 通过。
