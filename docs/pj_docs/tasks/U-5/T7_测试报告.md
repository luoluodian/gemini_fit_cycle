# U-5: 路由守卫 - T7 测试报告

## 7.1 测试环境
- **操作系统**: Darwin (macOS)
- **构建工具**: Taro CLI v4.1.9 + Vite
- **测试类型**: 逻辑流验证 + 构建自检

## 7.2 自动化测试结果

### 7.2.1 构建测试
- **命令**: `npm run build:weapp`
- **结果**: ✅ **PASS**
- **验证点**: 
  - `router/index.ts` 与 `useUserStore` 之间的循环依赖检查（通过）。
  - `app.ts` 中 `useLaunch` 的接入无语法错误。

## 7.3 手动验证计划 (核心安全用例)

### 用例 1: 未登录启动拦截
- **场景**: 用户从未登录过，直接打开应用（默认进入首页 `pages/index/index`）。
- **操作**: 启动应用。
- **预期**: 
  - 控制台显示 `[App] 启动拦截...`。
  - 页面瞬间从首页重定向至登录页。
  - 登录页 URL 包含 `?redirect=%2Fpages%2Findex%2Findex`。

### 用例 2: 编程式导航拦截
- **场景**: 已进入登录页，通过代码尝试调用 `navigateTo({ url: '/pages/profile/index' })`。
- **操作**: 模拟触发跳转代码。
- **预期**: 跳转被拦截，页面停留在登录页（或再次重定向至登录页，取决于具体实现），控制台抛出警告。

### 用例 3: 登录回跳验证
- **场景**: 用户在重定向后的登录页完成登录。
- **操作**: 点击“微信一键登录”并成功认证。
- **预期**: 
  - 登录成功后，应用不是跳转到默认首页，而是跳转回拦截前的 `pages/index/index`（或其他被拦截的页面）。

### 用例 4: 白名单豁免
- **场景**: 访问登录页本身。
- **操作**: 调用 `router.reLaunch(ROUTES.LOGIN)`。
- **预期**: 正常跳转，无拦截逻辑触发，无死循环。

## 7.4 覆盖率说明
- **场景覆盖**: 涵盖了“启动时拦截”与“运行时拦截”两个维度。
- **路径覆盖**: 已覆盖 `navigateTo`, `redirectTo`, `reLaunch`, `switchTab` 所有 Taro 基础跳转 API。
