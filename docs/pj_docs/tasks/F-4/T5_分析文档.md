# F-4: Food 表设计 - T5 分析文档

## 5.1 模块关联性审计

- **涉及核心表**: `foods`
- **涉及关联表**: 
  - `meal_records`: 记录用户摄入的食物（多对一）。
  - `plan_details`: 计划中推荐的食物（多对一）。
- **字段规范**:
  - `calories_per_100g`, `protein_per_100g`, `fat_per_100g`, `carbs_per_100g`: 核心营养指标，使用 `DECIMAL(8,2)`。
  - `gi`: 升糖指数，使用 `DECIMAL(5,2)`。
  - `default_unit`: 默认单位（g, ml, 片, 个等）。

## 5.2 影响评估

- **现状**: `initial-schema.sql` 中的 `foods` 表过于简陋，缺失了 `Food` 实体中定义的 `gi`, `image_url`, `description`, `updated_at` 等关键字段。
- **风险**: 数据库无法存储食物图片和详细描述，导致前端展示不完整。
- **解决方案**: 以 `Food` 实体代码为权威来源，补全 SQL 脚本。

## 5.3 技术落地计划

### 1. 表结构定义 (Target)
| 字段 | 类型 | 约束 | 说明 |
| :--- | :--- | :--- | :--- |
| id | BIGINT | PK, AI | 食物 ID |
| name | VARCHAR(100) | NOT NULL | 食物名称 |
| category | VARCHAR(50) | - | 食物类别 |
| calories_per_100g | DECIMAL(8,2)| DEFAULT 0 | 每100克热量 |
| protein_per_100g | DECIMAL(8,2) | DEFAULT 0 | 蛋白质 |
| fat_per_100g | DECIMAL(8,2) | DEFAULT 0 | 脂肪 |
| carbs_per_100g | DECIMAL(8,2) | DEFAULT 0 | 碳水 |
| gi | DECIMAL(5,2) | NULL | 升糖指数 |
| default_unit | VARCHAR(20) | DEFAULT 'g' | 默认单位 |
| image_url | VARCHAR(255) | NULL | 图片地址 |
| description | TEXT | NULL | 食物描述/备注 |
| created_at | DATETIME | DEFAULT NOW | 创建时间 |
| updated_at | DATETIME | DEFAULT NOW | 更新时间 |

### 2. 实现路径
1. 修改 `fit_cycle_app/src/database/migrations/initial-schema.sql` 中的 `foods` 表定义。
2. 添加 `updated_at` 触发器逻辑（如适用）。

## 5.4 验收标准 (T7 预案)
- [ ] SQL 脚本成功执行。
- [ ] `foods` 表结构与 `Food` 实体类属性完全对应。
- [ ] 索引 `idx_name` 和 `idx_category` 已正确创建。
