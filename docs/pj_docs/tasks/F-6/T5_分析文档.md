# F-6: 新增食物接口 - T5 分析文档

## 5.1 模块关联性审计

- **涉及核心表**: `foods` (已在 F-4 完成标准化)。
- **涉及控制器**: `FoodController` (`fit_cycle_app/src/modules/food/food.controller.ts`)。
- **涉及服务**: `FoodService`。
- **涉及数据传输对象**: `CreateFoodDto` (`fit_cycle_app/src/dtos/food.dto.ts`)。

## 5.2 影响评估

- **代码不一致性**: 
  - `Food` 实体采用 `caloriesPer100g` 等命名。
  - 现有的 `CreateFoodDto` 采用 `calorie`, `carbohydrate` 等命名。
  - `FoodService` 的查询、增加、更新逻辑均使用了过时的字段名。
- **风险**: 接口调用会因为字段不匹配导致 SQL 报错或数据无法入库。
- **解决方案**: 全量对齐 Entity、DTO 和 Service 逻辑。

## 5.3 技术落地计划

### 1. 字段标准化 (Target)
统一使用以下命名方案：
- `name` (名称)
- `category` (类别)
- `caloriesPer100g` (每100g热量)
- `proteinPer100g` (蛋白质)
- `fatPer100g` (脂肪)
- `carbsPer100g` (碳水)
- `gi` (升糖指数)
- `defaultUnit` (默认单位)
- `image_url` (图片)
- `description` (备注)

### 2. 实现路径
1. **修改 DTO**: 更新 `CreateFoodDto` 和 `UpdateFoodDto` 字段名及验证规则。
2. **重构 Service**:
   - `addFood`: 修正保存逻辑及重复检查。
   - `findFood`: 修正 `where` 条件过滤和 `sorting` 字段。
   - `updateFood`: 修正局部更新逻辑。
3. **控制器保持简洁**: 仅负责调用 Service。

## 5.4 验收标准 (T7 预案)
- [ ] `POST /food` 成功插入一条新食物，字段完全匹配。
- [ ] 同名食物插入时应返回错误提示。
- [ ] `GET /food` 的排序和过滤功能在应用新字段名后依然有效。
- [ ] `npm run build` 无编译错误。
