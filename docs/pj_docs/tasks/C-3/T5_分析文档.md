# C-3: 通用 NavBar 封装 - T5 分析文档

## 5.1 模块关联性审计

- **核心组件**: `fit_cycle_web/src/components/common/BaseNavBar.vue`
- **关联功能**: 
  - 沉浸式状态栏适配。
  - 统一的“返回”逻辑（处理页面栈）。
  - 标题居中与微信胶囊按钮对齐。
- **视觉风格**: 延续全站 **Glassmorphism** 标准。

## 5.2 技术难点分析

- **胶囊对齐**: 微信胶囊按钮在不同机型上的高度和间距不同。需通过 `getMenuButtonBoundingClientRect` 动态计算 titleBar 的高度。
- **层级管理**: 必须设为 `z-index: 9999` 并固定在顶部，同时为页面内容预留出占位高度（或在组件内提供占位 View）。

## 5.3 技术落地计划

### 1. 核心计算公式
- `StatusBarHeight`: `Taro.getSystemInfoSync().statusBarHeight`
- `TitleBarHeight`: `(胶囊顶部距离 - 状态栏高度) * 2 + 胶囊高度`
- `NavBarTotalHeight`: `StatusBarHeight + TitleBarHeight`

### 2. 组件接口 (Props)
- `title`: 字符串，页面标题。
- `showBack`: 布尔值，是否显示返回按钮。
- `background`: 字符串，背景 CSS（默认毛玻璃）。
- `fixed`: 布尔值，是否固定在顶部。

### 3. 返回逻辑
使用 `Taro.navigateBack()`，若页面栈深度为 1，则回退到首页。

## 5.4 验收标准 (T7 预案)
- [ ] 状态栏背景完全透明或符合设定的毛玻璃效果。
- [ ] 标题文字与右侧微信胶囊按钮水平居中对齐。
- [ ] 在 iPhone (全面屏) 和安卓 (刘海屏) 下位置表现一致。
- [ ] 点击返回按钮能正确跳转。
