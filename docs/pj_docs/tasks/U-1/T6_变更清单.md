# U-1: 实现微信登录认证接口 - T6 变更清单

## 6.1 新建文件

- `fit_cycle_app/src/dtos/auth-response.dto.ts`: 定义登录响应 DTO，包含 accessToken, refreshToken, user。
- `fit_cycle_app/test/auth.e2e-spec.ts`: 认证模块 E2E 测试文件。

## 6.2 修改文件

- `fit_cycle_app/src/modules/auth/auth.controller.ts`: 
    - 重命名 `login` -> `wechatLogin`。
    - 添加 Swagger 装饰器 (`@ApiOperation`, `@ApiResponse`)。
    - 明确返回类型为 `AuthResponseDto`。
- `fit_cycle_app/src/modules/auth/auth.service.ts`:
    - 注入 `UserService` 替代直接 Repository 操作。
    - 使用 `findOrCreateByOpenid`。
    - 完善 JWT 生成逻辑。
    - 修复 DTO 导入和类型断言。
- `fit_cycle_app/src/database/entity/user.entity.ts`:
    - 修正列名映射 (`openid` -> `open_id`, `avatarUrl` -> `avatar_url`)。
- `docs/pj_docs/04_接口与数据规约.md`:
    - 更新接口定义以匹配代码 (`/auth/wechatAuth`).

## 6.3 新增依赖

- `@nestjs/swagger`: 用于生成 API 文档。

## 6.4 环境变量变更

- 无。

## 6.5 数据库变更

- 无 schema 变更 (仅修正代码映射)。

## 6.6 完整性检查结果

### 【导入语句检查】
- [x] 所有导入的模块都已安装？ (`@nestjs/jwt`, `@nestjs/passport`, `axios` 等已确认)
- [x] 所有导入的文件路径都正确？ (IDE 无报错，编译通过)
- [x] 所有导入的类/函数都存在？ (`UserService`, `UserTransformer` 等已验证)

### 【类型定义检查】
- [x] 所有使用的类型都已定义？ (`WechatAuthDto`, `UserResponseDto` 已定义)
- [x] 所有 DTO 都已创建？ (`AuthResponseDto` 已创建)
- [x] 所有接口都已声明？ (Controller 返回类型明确)

### 【模块注册检查】
- [x] 新的 Service 是否已注册到 Module？ (`AuthService` in `AuthModule`)
- [x] 新的 Controller 是否已注册到 Module？ (`AuthController` in `AuthModule`)
- [x] 新的 Module 是否已导入到 AppModule？ (`AuthModule` is imported)

### 【依赖注入检查】
- [x] 所有依赖的 Service 是否已注入？ (`UserService`, `JwtService` 已注入)
- [x] 循环依赖是否已避免？ (检查通过)

### 【配置文件检查】
- [x] 环境变量是否已添加？ (使用现有 JWT_SECRET)
- [x] 配置项是否已更新？ (无新增)

### 【数据库检查】
- [x] 数据库迁移是否已创建？ (Schema 已存在)
- [x] Entity 关系是否正确？ (`open_id` 映射已修正)