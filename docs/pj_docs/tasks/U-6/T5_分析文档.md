# U-6: 用户信息接口 - T5 分析文档

## 5.1 模块关联性审计

- **涉及控制器**: `UserController` (`fit_cycle_app/src/modules/user/user.controller.ts`)
- **涉及服务**: `UserService`
- **涉及数据规约**: 
  - 前端服务 (`fit_cycle_web/src/services/modules/user.ts`) 期望路径为 `/user/info`。
  - 当前后端路径为 `/users/me`。
- **关联依赖**: `JwtAuthGuard` 确保只有登录用户可访问。

## 5.2 影响评估

- **修改点**:
  - 调整后端路由路径，将 `@Controller('users')` 改为 `@Controller('user')`。
  - 调整子路径 `me` 为 `info` 以匹配前端约定。
- **对现有功能的影响**:
  - 确保登录后的个人资料获取和更新逻辑畅通。
  - 需要同步检查是否有其他地方硬编码了旧路径 `/users/me`。

## 5.3 技术落地计划

### 1. 接口定义 (Target)
- **获取资料**: `GET /user/info`
  - 鉴权: Bearer Token
  - 返回: `UserResponseDto` (由 `UserTransformer` 转换)
- **更新资料**: `PUT /user/info`
  - 鉴权: Bearer Token
  - 请求体: `UpdateUserDto`
  - 返回: 更新后的用户信息

### 2. 实现逻辑
1. 修改 `UserController` 类装饰器为 `@Controller('user')`。
2. 将 `getMe` 路由修改为 `@Get('info')`。
3. 将 `updateMe` 路由修改为 `@Put('info')`。
4. 验证 `JwtStrategy` 的返回对象是否包含 `userId`（已确认）。

## 5.4 验收标准 (T7 预案)
- [ ] 调用 `GET /user/info` 返回当前登录用户资料。
- [ ] 调用 `PUT /user/info` 能成功修改数据库中的字段。
- [ ] 未携带 Token 访问时返回 401。
- [ ] 响应结构符合 `UserResponseDto`。
