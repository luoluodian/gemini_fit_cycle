# F-7: 食材搜索组件 - T5 分析文档

> **任务 ID**: F-7  
> **任务名称**: 食材搜索组件  
> **优先级**: P0  
> **垂直拆分**: 前端 Component / Logic  
> **预估工时**: 4h  
> **复杂度**: 中  
> **分析时间**: 2026-01-31  
> **分析人**: AI Assistant

---

## 5.1 模块关联性审计

### 涉及公共组件
- [x] `SearchBar.vue`: 已存在，可能需要增强搜索触发逻辑。
- [x] `CategoryTabs.vue`: 已存在，用于分类过滤。
- [x] `FoodCard.vue`: 已存在，用于展示搜索结果项。
- [x] `BaseModal.vue`: 底层弹窗。

### 涉及跨模块 Service
- `FoodItemsService` (fit_cycle_web/src/services/modules/food.ts): **缺失**，需要创建。
- 后端接口: `GET /food-items` (F-2 已完成)。

### UI 结构分析
- **参考文件**: `html/food-selector-embedded.html`
- **核心逻辑**:
    - 支持顶部关键词搜索。
    - 支持分类横向滚动切换。
    - 列表展示食材简要信息（热量、蛋白质等）。
    - 点击食材触发 `onSelect` 回调。
- **视觉风格**:
    - 搜索框带图标。
    - 分类 Tab 激活态为翡翠绿。
    - 列表项带悬停/点击反馈。

---

## 5.2 影响评估

### 需要修改的现有文件
- [ ] `fit_cycle_web/src/components/food/SearchBar.vue`: 确保能支持外部监听搜索输入。
- [ ] `fit_cycle_web/src/components/food/FoodList.vue`: 增强作为“搜索结果展示器”的能力。

### 新增文件清单
- [ ] `fit_cycle_web/src/services/modules/food.ts`: 封装前端食材搜索 API。
- [ ] `fit_cycle_web/src/components/food/FoodSelectorModal.vue`: **核心交付物**，整合搜索、分类与结果列表的容器组件。

---

## 5.3 技术落地计划

### 1. 服务封装 (Food Service)

```typescript
// fit_cycle_web/src/services/modules/food.ts
export const searchFoodItems = (params: QueryFoodItemDto) => {
  return httpRequest.get<PaginatedResponse<FoodItem>>('/food-items', params);
};
```

### 2. 组件 Props 定义

```typescript
interface Props {
  visible: boolean;
  title?: string;
}

const emit = defineEmits<{
  close: [];
  select: [food: FoodItem];
}>();
```

### 3. 交互流程

1.  **加载阶段**: `mounted` 或 `watch:visible` 时加载默认推荐/全量食材。
2.  **搜索阶段**: 监听输入，带 **Debounce (防抖)** 调用 `F-2` 接口。
3.  **筛选阶段**: 点击分类 Tab，更新 `category` 参数并重置 `page=1` 重新请求。
4.  **选择阶段**: 点击 `FoodCard`，关闭弹窗并向上抛出选中的食材对象。

### 4. 依赖任务检查

- [x] 依赖任务 `F-2` (后端接口) 已完成。

---

## 5.4 风险点清单

### 技术风险
- [ ] **性能/流量**: 搜索输入频繁请求。
  - 应对措施: 必须实现 300ms-500ms 的防抖逻辑。
- [ ] **跨端适配**: 小程序与 H5 在 `max-h-96` 滚动区域的处理差异。
  - 应对措施: 使用 Taro 的 `ScrollView` 组件。

---

## 5.5 预期交付物

### 代码交付物
- `fit_cycle_web/src/services/modules/food.ts`
- `fit_cycle_web/src/components/food/FoodSelectorModal.vue`

### 文档交付物
- T6~T9 全套文档。

---

## 5.6 自检清单
- [x] 确定了复用原型 `food-selector-embedded.js` 的计算逻辑。
- [x] 确定了防抖策略。
- [x] 确定了分页/无限滚动加载方案。

---

## 5.7 下一步行动
1. **立即执行**: 创建前端 Food Service 封装。
2. **立即执行**: 实现 `FoodSelectorModal.vue` 核心组件。
