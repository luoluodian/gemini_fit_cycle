# P-19 食物选择与配置组件 - 分析报告

> **任务 ID**: P-19  
> **任务名称**: 食物选择与配置组件  
> **优先级**: P0  
> **垂直拆分**: 前端组件  
> **预估工时**: 4h  
> **复杂度**: 中  
> **分析时间**: 2026-02-04 16:30  
> **分析人**: AI Assistant

---

## 1. 业务目标
实现一个高复用、交互流畅的“食物选择器”组件，用于在创建计划、记录饮食等多个场景中快速查找、筛选并添加食物。该组件需要支持搜索、多维度分类筛选，并在选中食物后提供数量输入和营养素实时预览功能。

## 2. 原型细节深度分析 (UI Analysis)
参考 `html/food-selector-embedded.html` 和 `html/food-selector-embedded.js`。

### 2.1 UI 结构
- **搜索栏**:
  - 位于顶部，包含搜索图标和清除按钮。
  - 实时过滤列表内容。
- **分类标签 (Horizontal Scroll)**:
  - 横向滚动容器，支持“全部”、“主食”、“蛋白质”、“蔬菜”、“水果”、“坚果”、“乳制品”等分类。
  - 选中态：Emerald-100 背景 + Emerald-700 文字。
  - 未选中态：Gray-100 背景 + Gray-600 文字。
- **食物列表**:
  - 垂直滚动区域。
  - **列表项 (Card)**:
    - 左侧：食物名称、单位热量信息、P/C/F 摘要、标签（如“低GI”）。
    - 右侧：添加按钮（`+` 或图标）。
    - 交互：点击整行触发选择。

### 2.2 数量配置弹窗 (Quantity Modal)
- **触发**: 点击列表项后弹出。
- **结构**:
  - 顶部：食物名称。
  - 中间：数量输入框 + 单位（如 `g`）。支持步进器或直接输入。
  - 预览区：灰色背景卡片，展示当前数量对应的 碳水/蛋白/脂肪/热量，数值随输入实时联动。
  - 底部：取消/确认按钮组。

---

## 3. 技术落地方案

### 3.1 组件拆分
我们将把这个功能拆分为两个核心组件：
1.  **`FoodSelectorModal.vue`** (容器组件):
    - 负责弹窗展示、搜索状态、分类筛选状态、列表渲染。
    - 依赖 `BaseModal` 作为底层容器。
2.  **`QuantityInputModal.vue`** (子组件):
    - 负责选中食物后的数量输入和营养计算。
    - 独立出来是为了复用性（例如在“编辑食物”时也可以用）。

### 3.2 数据流设计
```
[Parent Page]
  ↓ (props: visible, availableFoods)
[FoodSelectorModal]
  ↓ (User Selects Food)
  → (Internal State: selectedFood)
  ↓ (Show Quantity Modal)
[QuantityInputModal]
  ↓ (User Inputs Quantity)
  → (Real-time Calc Nutrition)
  ↓ (Emit: confirm)
[Parent Page] ← (Event: select-food { food, quantity, nutrition })
```

### 3.3 关键逻辑
- **模糊搜索**: 对 `foodName` 和 `tags` 进行大小写不敏感的匹配。
- **分类过滤**: 基于 `category` 字段进行精确匹配。
- **营养计算**: `currentVal = Math.round(baseVal * (inputQuantity / baseCount))`。

---

## 4. 风险与对策

- **性能**: 如果食物列表过长（>100条），渲染可能卡顿。
  - **对策**: 既然目前是本地数据，数量可控。未来对接 API 时，应实现分页加载或虚拟列表。目前使用 `BaseScrollView` 即可。
- **键盘遮挡**: 数量输入弹窗在底部，键盘弹起时可能遮挡确认按钮。
  - **对策**: 使用 Taro 的 `input` 组件 `adjust-position` 属性，或将弹窗推至页面上部。

---

## 5. 预期交付物
- `src/components/common/FoodSelectorModal.vue` (功能增强版)
- `src/components/common/QuantityInputModal.vue` (独立组件)
- 单元测试或集成测试用例。

---

**下一步**: 进入 T6 编码阶段，基于现有 `FoodSelectionModal.vue` 进行重构增强。
