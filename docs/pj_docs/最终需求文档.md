# 最终需求清单 (Requirements Final)

基于 `docs/init_docs/页面功能详细说明文档.md` 整理。

## 1. 业务流程与优先级

### P0 (核心/MVP)
- **用户认证**: 微信一键登录，Token 管理。
- **饮食记录**:
  - 首页日期导航 (查看历史/未来)。
  - 每日营养目标概览 (热量/三大营养素进度)。
  - 餐次展示 (早/午/晚/加餐) 及热量汇总。
  - 添加食物 (手动选择/搜索)。
  - 数量/单位录入。
- **基础数据**: 食物库浏览与搜索。

### P1 (重要)
- **计划管理**:
  - 计划列表 (进行中/已完成/已归档)。
  - 计划详情查看。
  - 创建计划 (自定义)。
  - 激活/暂停/归档计划。
- **用户隐私**: 隐私政策展示。

### P2 (优化/后期)
- **计划高级功能**:
  - 导入计划 (分享码)。
  - 推荐计划模板 (减脂/增肌等)。
  - 自动记录本餐 (基于计划自动填充)。
  - 计划统计 (完成度/数量)。

## 2. 功能模块详细说明

### 2.1 登录模块 (`/pages/login/index`)
- **UI**: Logo, 欢迎语, 微信登录按钮, 隐私政策链接.
- **逻辑**:
  - 调用微信登录 `login({ code })`。
  - 存储 `userToken`, `userRefToken`, `userInfo`。
  - 跳转至首页。
- **异常**: 登录失败提示。

### 2.2 首页/记录模块 (`/pages/index/index`)
- **日期导航**:
  - 切换日期 (前一天/后一天)。
  - 显示当前日期 ("今天" 特殊标识)。
  - 显示当前计划进度 (e.g., "第 7/42 天").
- **营养概览**:
  - 展示 热量, 蛋白质, 脂肪, 碳水 的 目标值 vs 当前值 (进度条 + 百分比)。
- **餐次卡片**:
  - 分类: 早餐, 午餐, 晚餐, 加餐。
  - 头部: 标题 + 餐次总热量。
  - 列表: 已添加食物 (名称, 数量, 热量)。
  - 操作: "添加食物" (打开 Modal), "记录本餐" (Todo: 基于计划自动填充).
- **食物添加流程**:
  - 点击添加 -> 打开 `FoodSelectionModal`。
  - 选择食物 -> 打开 `QuantityInputModal`。
  - 输入数量/单位 -> 确认 -> 更新首页数据。

### 2.3 计划管理模块 (`/pages/plan/index`)
- **列表展示**:
  - Tabs: 进行中 / 已完成 / 已归档。
  - 卡片信息: 名称, 类型, 进度, 剩余天数。
- **操作逻辑**:
  - **创建**: 悬浮按钮 / 顶部按钮 -> 打开创建模态框。
  - **导入**: 顶部按钮 -> 打开导入模态框 (输入分享码)。
  - **状态变更**:
    - 暂停 -> 激活 (互斥, 同时仅一个激活)。
    - 进行中 -> 编辑。
    - 已完成 -> 再次使用 (复制创建)。
    - 已归档 -> 恢复。
    - 更多操作: 分享, 删除, 归档。
- **推荐计划**: 展示预设模板 (减脂/增肌/均衡)。

### 2.4 通用组件
- **Modals**: 统一设计模式 (保持上下文, 支持取消).
- **Toast**: 错误/成功提示.
- **Loading**: 网络请求加载状态.

## 3. 非功能性需求
- **本地存储**: 离线可用性支持 (缓存 Token, 计划, 基础数据).
- **数据验证**:
  - 热量范围 (800-4000 kcal).
  - 必填项检查.
- **错误处理**: 统一拦截器处理网络及业务异常.
