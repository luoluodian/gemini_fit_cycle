# F-10: 热门食材接口 - T6 变更清单

> **变更日期**: 2026-01-31  
> **执行人**: AI Assistant

---

## 1. 变更摘要

本次任务实现了“热门食材”查询接口。该接口通过聚合统计所有用户的收藏数据，按收藏热度从高到低返回前 10 个食材，并支持根据当前登录用户动态显示收藏状态。

## 2. 文件变更列表

### 修改文件

| 文件路径 | 变更类型 | 说明 |
|:---|:---|:---|
| `fit_cycle_app/src/modules/food-items/food-items.service.ts` | 修改 | 新增 `getPopular` 方法，实现基于收藏量的聚合排序查询。 |
| `fit_cycle_app/src/modules/food-items/food-items.controller.ts` | 修改 | 暴露 `GET /food-items/popular` 接口。 |
| `fit_cycle_app/src/modules/food-items/food-items.service.spec.ts` | 修改 | 增加热门食材查询的单元测试用例。 |

## 3. 详细变更内容

### 3.1 业务逻辑实现 (`FoodItemsService`)
- [x] **聚合统计**: 使用 TypeORM QueryBuilder 执行 `LEFT JOIN` 和 `COUNT` 聚合。
- [x] **排序策略**: 首选按收藏数降序，次选按 ID 降序（保证新食材也有机会露出）。
- [x] **状态增强**: 针对已登录用户，二次遍历结果集并标记 `isFavorite`。

### 3.2 接口暴露 (`FoodItemsController`)
- [x] 路由: `GET /food-items/popular`。
- [x] 认证: 受 `JwtAuthGuard` 保护，以支持收藏状态返回。

## 4. 验证计划

1.  **构建验证**: 运行 `npm run build`。
2.  **单元测试**: 运行 `npm run test src/modules/food-items/food-items.service.spec.ts` 验证聚合排序逻辑。
