# U-8: 健康工具 UI - T6 变更清单

> **变更日期**: 2026-01-31  
> **执行人**: AI Assistant

---

## 1. 变更摘要

本次任务通过将 BMR 计算器模态框与后端 `PUT /user/info` 接口对接，实现了用户身体档案的在线同步。主要改进包括：
1.  **数据回显**: 打开模态框时自动从 Store 加载当前已保存的身高、体重、性别等数据。
2.  **异步同步**: 用户点击计算后，在前端展示即时结果的同时，自动调用后端接口保存数据。
3.  **状态管理**: 更新完成后自动刷新 `UserStore` 中的完整档案，确保全站数据一致。

## 2. 文件变更列表

### 修改文件

| 文件路径 | 变更类型 | 简要说明 |
|:---|:---|:---|
| `fit_cycle_web/src/stores/user.ts` | 修改 | 新增 `updateUserInfo` action，支持调用后端接口并刷新本地状态。 |
| `fit_cycle_web/src/components/profile/BMRCalculatorModal.vue` | 修改 | 引入 `UserStore`，实现数据回显逻辑，并集成接口调用。 |

## 3. 详细变更内容

### 3.1 `UserStore` (fit_cycle_web/src/stores/user.ts)
-   [x] 导入 `updateUserInfo` API 服务。
-   [x] 新增 `updateUserInfo(data: Partial<UserInfo>)` 方法。
-   [x] 在更新成功后调用 `fetchUserProfile()`，确保 BMR/TDEE 等计算字段与服务器同步。

### 3.2 `BMRCalculatorModal` (fit_cycle_web/src/components/profile/BMRCalculatorModal.vue)
-   [x] 使用 `watch` 监听 `visible` 属性，实现打开即回显。
-   [x] 增强 `handleCalculate` 方法，增加 `await userStore.updateUserInfo` 逻辑。
-   [x] 增加了简单的生日估算逻辑（基于年龄）以适配后端 `dateOfBirth` 必填/核心字段要求。

## 4. 验证计划

1.  **编译验证**: 运行 `npm run build:weapp` 确保无前端语法错误。
2.  **交互验证**: 手动测试计算器，观察控制台 Network 选项卡是否发出了 `PUT /user/info` 请求。
