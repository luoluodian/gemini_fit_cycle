# U-3: 登录页面 UI - T5 分析文档

> **任务 ID**: U-3
> **任务名称**: 登录页面 UI
> **优先级**: P0
> **垂直拆分**: 前端页面 / 组件
> **预估工时**: 1h
> **复杂度**: 低
> **分析时间**: 2026-01-31
> **分析人**: AI Assistant

---

## 5.1 模块关联性审计

### 涉及公共数据表
- [ ] 无

### 涉及公共组件
- [x] `LoginButton.vue`: 封装了登录和游客模式按钮。
- [x] `LogoHeader.vue`: Logo 展示区。
- [x] `WelcomeCard.vue`: 欢迎语和隐私提示。
- [x] `PrivacyModal.vue`: 隐私政策弹窗。
- [x] `BaseButton.vue`: 底层按钮组件。

### 涉及跨模块 Service
- [x] `UserStore` (`stores/user.ts`): 调用 `login` action。
- [x] `Router` (`router/index.ts`): 登录成功后跳转逻辑。

### 所有关联模块
- `Auth`, `Router`.

### UI 结构分析（前端任务必填）
- **参考文件**: `html/login.html`
- **DOM 结构**:
  - `LogoHeader`: Logo + App Name + Slogan (Floating Animation)
  - `WelcomeCard`: 隐私承诺说明 (Glass Effect)
  - `LoginButton`: 微信一键登录 (Primary) + 游客模式 (Secondary)
  - `PrivacyLink`: 底部文字链接
- **关键元素**: 
  - 微信登录按钮需要调用 `Taro.login`。
  - 错误提示需要美观展示（目前 `html/login.html` 中有红色错误提示区，Vue 组件中暂时未见显式错误提示组件，但在 `index.vue` 脚本中有 `showModal` 调用）。
- **交互逻辑**: 
  - 点击登录 -> Loading -> 获取 Code -> 后端验证 -> 存储 Token -> 跳转。
  - 点击游客 -> 本地标记 -> 跳转。
  - 点击隐私政策 -> 弹窗显示。

---

## 5.2 影响评估

### 需要修改的现有文件
- [x] `fit_cycle_web/src/pages/login/index.vue`:
    - 需优化 `handleWechatLogin` 的错误处理逻辑，确保用户拒绝授权或网络错误时有清晰提示。
    - 需确认页面布局（Flex 布局）是否在不同屏幕尺寸下表现良好（特别是 Logo 和 Button 的间距）。
- [x] `fit_cycle_web/src/components/login/LoginButton.vue`:
    - 审查按钮样式是否与 `html/login.html` 原型一致（阴影、圆角、渐变色）。
- [x] `fit_cycle_web/src/components/login/WelcomeCard.vue`:
    - 确认文案是否最新。

### 对现有功能的影响
- **无影响**: 登录页是入口，修改只会影响未登录用户。

### 必须参考的文件路径
- `html/login.html`: UI 还原的唯一真理。

### 潜在的破坏性变更
- **无破坏性变更**。

---

## 5.3 技术落地计划

### 1. 文件创建清单
无新文件。

### 2. 代码审计与修正点

#### 前端方法 (`index.vue`)
- **现状**: 逻辑基本完整。
- **修正目标**: 
  - 对比 `html/login.html`，发现原型的错误提示是内嵌在页面中的 (`#errorMessage` div)，而 Vue 实现用的是 `showModal`。考虑到移动端体验，`showModal` 是可以接受的，但如果为了极致还原，可以考虑引入一个 `Alert` 组件。建议保持 `showModal` 或 `showToast`，简单直接。
  - 动画效果：`animate-item` 类在 `index.scss` 中定义了 fade-in 效果，需确认是否生效。

#### 前端方法 (`LoginButton.vue`)
- **现状**: 使用了 `BaseButton`。
- **修正目标**: 检查 `BaseButton` 的 `wechat` 类型样式是否匹配 `html/login.html` 中的 `.wechat-btn` 样式（渐变色 `#07c160` -> `#06ad56`）。

### 3. UI 交互流程
```
用户打开登录页 -> 触发动画 -> 点击微信登录 -> Taro.login -> UserStore.login -> API -> Token -> 跳转首页
```

### 5. 依赖任务检查
- [x] 依赖任务 `U-2` 已完成 (Store/AuthService 就绪)。

---

## 5.4 风险点清单

### 兼容性风险（前端任务）
- [x] **小屏适配**: 检查 `min-h-screen` 和 `flex-col` 在 iPhone SE 等小屏上是否会导致按钮被挤出屏幕或重叠。
  - **对策**: 使用 `min-h-screen` 配合 `py-8` 或 `space-y` 确保垂直方向有足够呼吸感，必要时允许滚动。

---

## 5.5 预期交付物

### 代码交付物
- 微调后的 `LoginButton.vue` (样式)。
- 微调后的 `index.vue` (交互细节)。

### 文档交付物
- `docs/pj_docs/U-3/U-3_分析文档.md`

---

## 5.6 自检清单

- [x] 所有关联模块已识别
- [x] 所有影响范围已评估
- [x] 技术方案可行且清晰
- [x] UI 结构已分析

---

## 5.7 下一步行动

1. **立即执行**: 
   - 检查 `LoginButton.vue` 和 `BaseButton.vue` 的样式代码。
   - 确认 `index.vue` 中的错误处理逻辑。
2. **需要澄清**: 无。
