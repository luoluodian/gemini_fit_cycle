# F-5: 自定义食材 API - T6 变更清单

> **变更日期**: 2026-01-31  
> **执行人**: AI Assistant

---

## 1. 变更摘要

本次任务正式确立并验证了自定义食材的增删改查（CRUD）接口。核心代码已在前期重构中实现，本次任务主要通过合规性检查确认为交付基准，并确保权限控制逻辑（仅限创建者操作）的正确性。

## 2. 文件确认列表

| 文件路径 | 状态 | 简要说明 |
|:---|:---|:---|
| `fit_cycle_app/src/modules/food-items/food-items.controller.ts` | 确认 | 暴露了 `POST`, `PUT`, `DELETE` 接口，并正确应用了 `JwtAuthGuard`。 |
| `fit_cycle_app/src/modules/food-items/food-items.service.ts` | 确认 | 实现了 `create`, `update`, `delete` 方法，包含权限校验和名称唯一性逻辑。 |

## 3. 详细逻辑内容

### 3.1 权限控制校验
- [x] **Update**: Service 中检查 `item.userId === userId`，否则抛出 `ForbiddenException`。
- [x] **Delete**: Service 中检查 `item.userId === userId`，否则抛出 `ForbiddenException`。

### 3.2 业务规则确认
- [x] **创建者绑定**: 新建食材自动设置 `type: CUSTOM` 并关联当前 UID。
- [x] **冲突检查**: 更新名称时，排除自身 ID 后的重名检查。

## 4. 验证计划

1.  **构建验证**: 运行 `npm run build`。
2.  **单元测试**: (将在 T7 阶段执行) 补全 `create`, `update`, `delete` 的单元测试用例，重点覆盖权限越权场景。
