# F-1: 系统食材导入 - T6 变更清单

> **变更日期**: 2026-01-31  
> **执行人**: AI Assistant

---

## 1. 变更摘要

本次任务完成了食材实体模型的重构与统一，并实现了系统食材的同步逻辑。主要动作包括：
1.  **实体重构**: 按规约重写 `FoodItem` 实体，合并了原有的 `Food` 实体。
2.  **清理冗余**: 删除了废弃的 `Food` 实体及其关联的 `FoodModule` 和 DTO。
3.  **功能实现**: 在 `FoodItemsService` 中实现了 `syncSystemFoods` 事务同步方法。
4.  **接口暴露**: 在 `FoodItemsController` 暴露了同步触发接口。

## 2. 文件变更列表

### 修改文件

| 文件路径 | 变更类型 | 说明 |
|:---|:---|:---|
| `fit_cycle_app/src/database/entity/food-item.entity.ts` | 修改 | 重构字段，增加 Enum 定义。 |
| `fit_cycle_app/src/modules/food-items/food-items.service.ts` | 修改 | 实现 `syncSystemFoods` 逻辑。 |
| `fit_cycle_app/src/modules/food-items/food-items.controller.ts` | 修改 | 增加 `/sync` 同步接口。 |
| `fit_cycle_app/src/dtos/food-item.dto.ts` | 修改 | 对齐最新实体字段。 |
| `fit_cycle_app/src/database/entities.module.ts` | 修改 | 移除 `Food` 实体注册。 |
| `fit_cycle_app/src/app.module.ts` | 修改 | 移除 `FoodModule` 导入。 |
| `fit_cycle_app/src/database/entity/meal-record.entity.ts` | 修改 | 修正导入引用。 |
| `fit_cycle_app/src/database/entity/plan-detail.entity.ts` | 修改 | 修正导入引用。 |

### 删除文件

| 文件路径 | 说明 |
|:---|:---|
| `fit_cycle_app/src/database/entity/food.entity.ts` | 冗余实体。 |
| `fit_cycle_app/src/modules/food/` | 冗余模块。 |
| `fit_cycle_app/src/dtos/food.dto.ts` | 冗余 DTO。 |
| `fit_cycle_app/src/dtos/create-food-item.dto.ts` | 冗余 DTO (已合并)。 |
| `fit_cycle_app/src/dtos/update-food-item.dto.ts` | 冗余 DTO (已合并)。 |

## 3. 详细确认内容

- [x] **字段对齐**: `FoodItem` 实体字段与 `01_initial_schema.sql` 完全一致。
- [x] **事务安全**: `syncSystemFoods` 使用了 `manager` 确保同步过程的原子性。
- [x] **Enum 应用**: 引入了 `FoodType` 和 `FoodCategory` 增强类型安全。

## 4. 验证计划

1.  **同步验证**: 通过调用 `POST /food-items/sync` 验证数据是否成功导入数据库。
2.  **查询验证**: 调用 `GET /food-items` 验证导入的数据是否可被搜索。
