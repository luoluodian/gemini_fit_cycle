# P-10: 一键补满逻辑 - T5 分析文档

> **任务 ID**: P-10  
> **任务名称**: 智能一键补满逻辑  
> **优先级**: P1  
> **垂直拆分**: 前端逻辑 + UI 交互  
> **复杂度**: 高  
> **分析时间**: 2026-02-04 19:00  
> **分析人**: AI Assistant

---

## 1. 业务目标
为用户提供一种智能化的辅助手段，在编辑饮食计划日模板时，能够根据当前设定的营养目标（热量、蛋白质、碳水、脂肪）与已选食物的差值，自动从食材库中匹配并推荐合适的食材及分量，实现“一键达标”。

## 2. 场景分析 (Scenarios)
- **场景 A**: 用户已添加了早餐和午餐，发现全天还差 20g 蛋白质和 200kcal，点击“补满”到晚餐。
- **场景 B**: 用户新建了空白模板，设定了目标（如高碳日 2200kcal），点击“一键补满”生成推荐草案。

## 3. 交互设计 (Interaction)
### 3.1 入口位置
- **建议 1**: 在 `edit-template` 页面的每个餐次操作菜单 (⋮) 中增加“智能补满本餐”选项。
- **建议 2**: 在页面底部增加全局“一键补满全天”按钮（优先级更高，能自动分配到各个空餐次）。

### 3.2 流程
1. 用户点击“一键补满”。
2. 系统计算 **全天缺口** = 目标 - Σ(已选食物)。
3. 系统从“常用食材”或“系统精选食材”中筛选符合缺口比例的食材。
4. 计算所需克数，并将其添加至当前选中的餐次（或默认加餐）。
5. 弹出成功提示并展示补满了哪些食材。

---

## 4. 核心算法设计 (Matching Algorithm)

### 4.1 缺口计算
```typescript
gap = {
  calories: target.calories - current.calories,
  protein: target.protein - current.protein,
  carbs: target.carbs - current.carbs,
  fat: target.fat - current.fat
}
```

### 4.2 食材匹配策略
由于不可能 100% 完美匹配所有四个维度，算法采取“**权重优先级**”策略：
1. **主要指标**: 优先匹配 **蛋白质** 和 **热量**。
2. **候选池**: 从 `getPopularFoodItems` 接口拉取的高频食材中选择。
3. **分量计算**: 
   - 假设选中食材为鸡胸肉（每100g含 31g 蛋白）。
   - 所需分量 = (gap.protein / 31) * 100。
   - 检查该分量产生的热量是否超出 `gap.calories`。

---

## 5. 技术落地计划

### 1. Store Action 扩展 (`src/stores/plan.ts`)
- 实现 `smartFillTemplate(index, mealType)` 方法。

### 2. 页面集成 (`src/pages/edit-template/index.vue`)
- 在 `handleMealMenu` 中增加“智能补齐缺口”选项。
- 调用 `foodService.getPopularFoodItems()` 获取基准食材。

---

## 6. 风险点清单

- **计算冲突**: 如果用户目标设定不合理（如低热量但超高蛋白），算法可能无法找到匹配食材。
  - **对策**: 设置最大尝试次数，若无法完美匹配，则优先补齐蛋白质并提示用户手动微调。
- **数据新鲜度**: 依赖后端食材库数据。

---

**分析完成时间**: 2026-02-04 19:15  
**预计开始编码时间**: 2026-02-04 19:20  
**预计完成时间**: 2026-02-04 21:00
