# P-13: 计划详情页 UI - T5 分析文档

> **任务 ID**: P-13  
> **任务名称**: 计划详情页 UI  
> **优先级**: P1  
> **垂直拆分**: 前端页面 + 状态管理  
> **复杂度**: 中  
> **分析时间**: 2026-02-04 17:30  
> **分析人**: AI Assistant

---

## 5.1 模块关联性审计

### 涉及公共组件
- [x] `BaseNavBar` (`src/components/common/BaseNavBar.vue`)
- [x] `BaseScrollView` (`src/components/common/BaseScrollView.vue`)
- [x] `GlassCard` (`src/components/common/GlassCard.vue`)
- [x] `BaseButton` (`src/components/common/BaseButton.vue`)

### 关联模块
- `PlanStore`: 读取当前查看的计划详情。
- `PlanService`: 调用 `getPlanDetail`, `activatePlan`, `pausePlan`, `deletePlan` 等接口。

---

## 5.2 影响评估

### 需要修改的现有文件
- [x] `src/app.config.ts`: 注册新页面路径 `/pages/plan-detail/index`。
- [x] `src/router/index.ts`: (如有) 增加路由常量。

### 必须参考的文件路径
- `html/plan-detail.html`: 视觉与交互原型。
- `docs/pj_docs/04_接口与数据规约.md`: 确保返回的数据结构包含 `planDays`, `planMeals` 等。

---

## 5.3 技术落地计划

### 1. 页面结构 (Page Structure)
- **容器**: `h-screen flex flex-col overflow-hidden`。
- **Header**: 居中标题，右侧插槽放置“更多 (⋮)”按钮。
- **Body**: `BaseScrollView` 承载内容。
  - **模块 1: 进度概览**: 展示当前状态、百分比、天数大数字、进度条。
  - **模块 2: 计划日程**: 按周期 (Cycle) 分组展示天数网格。使用彩色小圆点标识碳循环阶段。
  - **模块 3: 碳循环配置 (可选)**: 仅在碳循环计划下显示体重和三大营养素分配。

### 2. 交互逻辑 (Interaction)
- **点击天数**: 跳转至该天的模板编辑页 (P-9)。
- **点击更多**: 弹出 `Taro.showActionSheet`。
  - 选项: 编辑计划、分享计划 (P-14)、暂停/激活计划、删除计划。
- **删除逻辑**: 弹出 `Taro.showModal` 二次确认。

### 3. 数据流向 (Data Flow)
```
[Route Params: id] → [onMounted: planService.getPlanDetail(id)] 
  ↓
[localState: planDetail] → [UI Rendering]
```

---

## 5.4 风险点清单

### 逻辑风险
- **碳循环计算同步**: 详情页显示的阶段克数必须与创建时的算法结果完全一致。
- **天数溢出**: 长周期计划（如 12 周）会导致日程网格过长，需确保 `BaseScrollView` 性能。

---

## 5.5 下一步行动

1. **立即执行**: 创建页面文件 `src/pages/plan-detail/index.vue`。
2. **立即执行**: 拆分核心子组件 `PlanOverview.vue` 和 `ScheduleGrid.vue`。

---

**分析完成时间**: 2026-02-04 17:45  
**预计开始编码时间**: 2026-02-04 17:50  
**预计完成时间**: 2026-02-04 19:30
