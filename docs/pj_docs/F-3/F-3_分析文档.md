# F-3: 食材详情接口 - T5 分析文档

> **任务 ID**: F-3  
> **任务名称**: 食材详情接口  
> **优先级**: P0  
> **垂直拆分**: 后端 API  
> **预估工时**: 1h  
> **复杂度**: 低  
> **分析时间**: 2026-01-31  
> **分析人**: AI Assistant

---

## 5.1 模块关联性审计

### 涉及公共数据表
- [x] `food_items`: 存储食材及其营养成分的核心表。

### 涉及跨模块 Service
- `FoodItemsService`: 提供根据 ID 查询食材详情的逻辑。

### 所有关联模块
- `Food Domain`: 核心功能。
- `Frontend`: 点击食材列表项进入详情页时调用。

---

## 5.2 影响评估

### 需要修改的现有文件
- [x] `fit_cycle_app/src/modules/food-items/food-items.service.ts`: 确认并增强 `detail` 方法。
- [x] `fit_cycle_app/src/modules/food-items/food-items.controller.ts`: 确认并增强 `detail` 接口。

### 对现有功能的影响
- [x] **无影响**: 接口已初步存在，本次任务主要是进行合规性验证与交付。

---

## 5.3 技术落地计划

### 1. 接口契约确认

**请求**: `GET /food-items/:id`
- `id`: 食材的主键 ID (BigInt)。

**响应**: `FoodItem` 实体对象
```json
{
  "id": "1",
  "name": "鸡胸肉",
  "calories": 165,
  "protein": 31.00,
  "fat": 3.60,
  "carbs": 0.00,
  "unit": "g",
  "category": "protein",
  ...
}
```

### 2. 逻辑实现路径

1.  **参数提取**: Controller 使用 `@Param('id', ParseIntPipe)` 接收并验证 ID。
2.  **查询逻辑**: Service 调用 `foodRepo.findOne({ where: { id } })`。
3.  **异常处理**: 若查询结果为空，抛出 `NotFoundException` (404)。

### 3. 数据流向

```
Frontend (ID) -> Controller -> Service -> Repository -> Database
                                            |
                                     (If Not Found) -> 404 Error
```

### 4. 依赖任务检查

- [x] 依赖任务 `F-1` (实体定义) 已完成。

---

## 5.4 风险点清单

### 技术风险
- [ ] **ID 类型溢出**: 数据库 ID 为 `BigInt`，在 JS 中读取时需注意精度。
  - 应对措施: NestJS 默认处理 BigInt 为 string 或由 TypeORM 自动转换。目前数据量级下 `number` 暂无精度问题。

---

## 5.5 预期交付物

### 代码交付物
- `fit_cycle_app/src/modules/food-items/food-items.service.ts` (确认实现)
- `fit_cycle_app/src/modules/food-items/food-items.controller.ts` (确认实现)

### 文档交付物
- T6_变更清单.md
- T7_测试报告.md
- T8_审计报告.md
- T9_交付报告.md

---

## 5.6 自检清单

- [x] 接口路径符合规约
- [x] ID 参数有类型验证 (ParseIntPipe)
- [x] 存在 404 错误处理机制

---

## 5.7 下一步行动

1. **立即执行**: 进入 T6 编码阶段，正式确认代码实现。
