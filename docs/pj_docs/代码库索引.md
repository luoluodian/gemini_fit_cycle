# 代码库索引 (Codebase Index)

## 1. 后端架构 (`fit_cycle_app/src`)

### 1.1 核心模块 (Modules)
- `app.module.ts`: 应用根模块
- `modules/auth/auth.module.ts`: 认证模块
- `modules/user/user.module.ts`: 用户模块
- `modules/food-items/food-items.module.ts`: 食材库模块
- `modules/diet-plans/diet-plans.module.ts`: 饮食计划模块
- `modules/diet-logs/diet-logs.module.ts`: 饮食记录模块
- `modules/today-diet/today-diet.module.ts`: 今日记录聚合模块
- `modules/dict/dict.module.ts`: 数据字典模块
- `modules/share/share.module.ts`: 分享模块
- `database/database.module.ts`: 数据库基础模块
- `database/entities.module.ts`: 实体统一导出模块
- `config/config.module.ts`: 配置模块
- `redis/redis.module.ts`: Redis 缓存模块

### 1.2 服务层 (Services)
- `modules/auth/auth.service.ts`: 认证、Token、微信登录逻辑
- `modules/user/user.service.ts`: 用户资料、健康档案、BMR/TDEE 计算
- `modules/food-items/food-items.service.ts`: 食材搜索、创建、收藏、热门统计
- `modules/diet-plans/diet-plans.service.ts`: 计划管理、阶段计算
- `modules/diet-logs/diet-logs.service.ts`: 每日打卡记录
- `modules/today-diet/today-diet.service.ts`: 首页聚合数据展示
- `modules/dict/dict.service.ts`: 字典查询
- `modules/share/share.service.ts`: 计划导入导出分享逻辑
- `redis/redis.service.ts`: Redis 操作封装

### 1.3 控制层 (Controllers)
- `app.controller.ts`: 基础状态检查
- `modules/auth/auth.controller.ts`: 登录、刷新 Token 接口
- `modules/user/user.controller.ts`: 个人中心、资料更新接口
- `modules/food-items/food-items.controller.ts`: 食材库 CRUD 及收藏接口
- `modules/diet-plans/diet-plans.controller.ts`: 饮食计划 CRUD
- `modules/diet-logs/diet-logs.controller.ts`: 记录打卡接口
- `modules/today-diet/today-diet.controller.ts`: 首页接口
- `modules/dict/dict.controller.ts`: 字典接口
- `modules/share/share.controller.ts`: 分享接口

### 1.4 数据库实体 (Entities)
- `database/entity/user.entity.ts`: 用户基础表
- `database/entity/health-profile.entity.ts`: 用户健康档案表
- `database/entity/food-item.entity.ts`: 食材库表 (含 baseCount 基准)
- `database/entity/user-favorite-food.entity.ts`: 用户食材收藏表
- `database/entity/diet-plan.entity.ts`: 饮食计划主表
- `database/entity/plan-day.entity.ts`: 计划具体天数配置
- `database/entity/plan-meal.entity.ts`: 计划餐次配置
- `database/entity/plan-meal-item.entity.ts`: 计划餐次内食材配置
- `database/entity/diet-log.entity.ts`: 饮食打卡记录表
- `database/entity/data-dictionary.entity.ts`: 数据字典表

### 1.5 数据传输对象 (DTOs)
- `dtos/auth-login.dto.ts`: 登录请求
- `dtos/user.dto.ts`: 用户更新、微信授权
- `dtos/food-item.dto.ts`: 食材创建、更新、查询 (支持 baseCount)
- `dtos/create-diet-plan.dto.ts`: 计划创建
- `dtos/create-diet-log.dto.ts`: 记录创建
- `dtos/dict.dto.ts`: 字典查询

### 1.6 公共工具与中间件 (Common)
- `common/interceptors/transform.interceptor.ts`: 响应结构统一封装 (`code`, `message`, `data`)
- `common/interceptors/trim.interceptor.ts`: 输入参数自动去空格
- `common/filters/http-exception.filter.ts`: 全局异常处理与日志记录
- `common/logger/app.logger.ts`: Winston 日志集成
- `common/logger/trace.middleware.ts`: TraceId 追踪中间件
- `common/transformers/user.transformer.ts`: 用户嵌套结构转换器
- `common/utils/trace.util.ts`: 链路追踪工具

---

## 2. 前端架构 (`fit_cycle_web/src`)

### 2.1 页面 (Pages)
- `pages/index/index.vue`: 首页 (今日记录、目标进度)
- `pages/food/index.vue`: 食材库 (分类搜索、热门食材、自建管理)
- `pages/plan/index.vue`: 计划列表 (我的计划、推荐计划)
- `pages/plan-creator/index.vue`: 计划创建 (分步表单)
- `pages/daily-plan/index.vue`: 计划详情 (按天配置饮食)
- `pages/daily-list/index.vue`: 历史记录列表
- `pages/profile/index.vue`: 个人中心 (健康工具、关于、退出)
- `pages/login/index.vue`: 登录页面

### 2.2 业务组件 (Components)
- **Home**: `DailyGoalsOverview`, `DateNavigation`, `MealCard`
- **Food**: `FoodPicker` (通用食材选择器), `FoodCategoryBar` (分类滑动条), `FoodItemCard` (食材列表项), `CustomFoodModal`, `FoodDetailModal` (食材详情与量化)
- **Plan**: `PlanCard`, `PlanStats`, `RecommendedPlans`, `NewPlanModal`
- **DailyPlan**: `MealTabs`, `TargetsModal`, `QuickSuggestions`
- **Common (原子组件)**: `BaseNavBar`, `BaseModal`, `BaseButton`, `BaseScrollView` (无限滚动容器), `GlassCard`, `ProgressBar`, `SearchBar`

### 2.3 状态管理 (Stores)
- `stores/user.ts`: 用户认证状态、Token 自动刷新、资料持久化
- `stores/plan.ts`: 计划创建、日模板配置、食材选择状态持久化
- `stores/navigation.ts`: Tabbar 选中状态管理

### 2.4 服务层 (Services)
- `services/http/request.ts`: 基于 Taro.request 的请求核心封装
- `services/http/interceptors.ts`: **核心逻辑** (Auth 自动刷新重试、错误兜底)
- `services/modules/auth.ts`: 微信登录、刷新 Token 接口
- `services/modules/food.ts`: 食材库 API (搜索、收藏、删除)
- `services/modules/user.ts`: 用户档案、健康计算 API
- `services/modules/plan.ts`: 计划管理 API
- `services/modules/record.ts`: 打卡记录 API

### 2.5 常量与配置 (Constants)
- `constants/api-config.ts`: **鉴权路由配置**、BaseURL 控制
- `constants/routes.ts`: 页面路由统一常量
- `constants/storage.ts`: 本本地缓存 Key 定义
- `constants/food-categories.ts`: 食材分类、图标、主题色配置

### 2.6 工具类 (Utils)
- `utils/env.ts`: 环境判断 (H5 vs MiniProgram)
- `utils/error-handler.ts`: 业务错误统一处理逻辑
- `utils/storage.ts`: 跨平台持久化封装
- `utils/toast.ts`: 交互提示封装

---

## 3. 自动化测试架构 (`tests/minium`)

### 3.1 测试用例 (Test Cases)
- `case/test_plan_v7_7.py`: **V7.7 核心用例集** (含正向闭环、量化反馈、静默修复校验)
- `case/base_test.py`: Minium 测试基类 (自动注入 Token、环境初始化)

### 3.2 驱动与执行器 (Executors)
- `executor.py`: **自愈型执行器** (集成 JS 注入、错误重试、MD 报告自动生成)
- `protocol_tester.py`: **协议级驱动器** (在 UI 解析受限时，通过 API 契约验证业务灵魂逻辑)
- `run_plan_flow.py`: 简易 E2E 流程跑通工具

### 3.3 注入逻辑与辅助工具 (Utils)
- `utils/injected_logic.js`: **跨障碍 JS 脚本** (直接操作小程序 Page/Store 的原生逻辑)
- `utils/db_checker.py`: 后端 SQLite/MySQL 数据库校验工具
- `config.json`: Minium 运行环境配置 (端口、路径、Mock 策略)

### 3.4 测试成果 (Outputs)
- `outputs/REPORT_M-FOR-01.md`: 计划创建全流程功能测试报告
- `outputs/REPORT_M-FOR-03.md`: 数据量化与反馈功能测试报告
- `outputs/REPORT_M-REP-01.md`: 数据一致性与自修复功能测试报告
