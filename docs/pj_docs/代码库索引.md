# 项目代码库索引

> **最后更新**: 2026-01-28
> **版本**: 1.1 (同步 U-1 至 U-9 的所有变更)

## 1. 后端 (fit_cycle_app)

### 1.1 核心模块 (Modules)
- `AuthModule`: `src/modules/auth/auth.module.ts` - 认证与授权管理。
- `UserModule`: `src/modules/user/user.module.ts` - 用户资料与档案管理。
- `FoodModule`: `src/modules/food/food.module.ts` - 核心食物库管理。
- `DietLogsModule`: `src/modules/diet-logs/diet-logs.module.ts` - 饮食记录追踪。
- `DietPlansModule`: `src/modules/diet-plans/diet-plans.module.ts` - 饮食计划制定。
- `DictModule`: `src/modules/dict/dict.module.ts` - 数据字典服务。
- `FoodItemModule`: `src/modules/food-items/food-items.module.ts` - 食物细项管理。
- `ShareModule`: `src/modules/share/share.module.ts` - 计划分享与社交。
- `RedisModule`: `src/redis/redis.module.ts` - 缓存服务。
- `DatabaseModule`: `src/database/database.module.ts` - 数据库连接配置。

### 1.2 控制器 (Controllers)
- `AuthController`: `src/modules/auth/auth.controller.ts` - 处理 `/auth/wechatAuth` 等。
- `UserController`: `src/modules/user/user.controller.ts` - 处理 `/user/info` 等。
- `FoodController`: `src/modules/food/food.controller.ts`
- `DietLogsController`: `src/modules/diet-logs/diet-logs.controller.ts`
- `DietPlansController`: `src/modules/diet-plans/diet-plans.controller.ts`
- `DictController`: `src/modules/dict/dict.controller.ts`

### 1.3 服务层 (Services)
- `AuthService`: `src/modules/auth/auth.service.ts` - 包含 Mock 微信登录逻辑。
- `UserService`: `src/modules/user/user.service.ts` - 包含 `findOrCreateByOpenid` (已修复 ID 生成 Bug)。
- `FoodService`: `src/modules/food/food.service.ts`
- `DietLogsService`: `src/modules/diet-logs/diet-logs.service.ts`
- `DietPlansService`: `src/modules/diet-plans/diet-plans.service.ts`
- `RedisService`: `src/redis/redis.service.ts`

### 1.4 数据实体 (Entities)
- `User`: `src/database/entity/user.entity.ts` - 用户核心表（含 `open_id`, `email`, `phone` 等）。
- `Food`: `src/database/entity/food.entity.ts`
- `DietLog`: `src/database/entity/diet-log.entity.ts`
- `WeightRecord`: `src/database/entity/weight-record.entity.ts`
- `DailyCheckin`: `src/database/entity/daily-checkin.entity.ts`
- `ExerciseLog`: `src/database/entity/exercise-log.entity.ts`

### 1.5 数据传输对象 (DTOs)
- `WechatAuthDto`: `src/dtos/user.dto.ts`
- `AuthResponseDto`: `src/dtos/auth-response.dto.ts`
- `UpdateUserDto`: `src/dtos/user.dto.ts`

### 1.6 公共工具与拦截器 (Common)
- `HttpExceptionFilter`: `src/common/filters/http-exception.filter.ts`
- `TransformInterceptor`: `src/common/interceptors/transform.interceptor.ts`
- `TrimInterceptor`: `src/common/interceptors/trim.interceptor.ts` - **修复版**: 原地修改属性，解决 Read-only 报错。
- `UserTransformer`: `src/common/transformers/user.transformer.ts`

---

## 2. 前端 (fit_cycle_web)

### 2.1 页面视图 (Pages)
- `Login`: `src/pages/login/index.vue` - 登录入口（含 CSS 阶梯入场动画）。
- `Home`: `src/pages/index/index.vue` - 今日饮食概览。
- `Profile`: `src/pages/profile/index.vue` - 个人中心（已对接 `userStore`）。
- `PlanOverview`: `src/pages/plan/index.vue`
- `DailyList`: `src/pages/daily-list/index.vue`
- `FoodLibrary`: `src/pages/food/index.vue`

### 2.2 公共组件 (Common Components)
- `BaseButton`: `src/components/common/BaseButton.vue` - **原子组件**: 统一按钮样式，支持 loading/disabled。
- `BaseModal`: `src/components/common/BaseModal.vue` - **容器组件**: 统一弹窗交互与圆角。
- `MenuItem`: `src/components/common/MenuItem.vue` - **原子组件**: 统一列表项布局与位移反馈。
- `GlassCard`: `src/components/common/GlassCard.vue` - **容器组件**: 统一毛玻璃视觉效果。

### 2.3 业务组件 (Business Components)
- **Login**:
  - `LoginButton.vue`: 接入 `BaseButton`，区分微信/游客模式。
  - `PrivacyModal.vue`: 基于 `BaseModal` 实现，高度 `80vh`，支持滑动。
- **Profile**:
  - `ProfileHeader.vue`: 动态展示头像/昵称。
  - `WeeklyProgressChart.vue`: **高性能重构版**: 纯 CSS 实现，替代 ECharts。
  - `HealthTools.vue` / `SettingsMenu.vue`: 接入 `MenuItem` 统一列表。

### 2.4 状态管理 (Stores)
- `userStore`: `src/stores/user.ts` - 核心状态，持久化存储 `access_token` 等。

### 2.5 服务层 (Services)
- `HttpService`: `src/services/http/interceptors.ts` - **认证拦截器**: 统一处理 Token 注入与 401 并发刷新。
- `AuthService`: `src/services/modules/auth.ts`
- `UserService`: `src/services/modules/user.ts` - 提供 `getUserInfo`, `refreshToken`。

### 2.6 路由管理 (Router)
- `RouterWrapper`: `src/router/index.ts` - **路由守卫**: 拦截未登录访问，支持 `redirect` 参数。
- `RouteConstants`: `src/constants/routes.ts` - 定义 `PUBLIC_PAGES` 白名单。