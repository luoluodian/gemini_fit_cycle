# 代码库索引 (Codebase Index)

## 1. 后端架构 (`fit_cycle_app/src`)

### 1.1 核心模块 (Modules)
- `app.module.ts`: 应用根模块
- `modules/auth/auth.module.ts`: 认证模块
- `modules/user/user.module.ts`: 用户模块
- `modules/food-items/food-items.module.ts`: 食材库模块
- `modules/diet-plans/diet-plans.module.ts`: 饮食计划模块
- `modules/diet-records/diet-records.module.ts`: 饮食记录模块 (取代旧版 diet-logs 与 today-diet)
- `modules/dict/dict.module.ts`: 数据字典模块
- `modules/share/share.module.ts`: 分享模块
- `database/database.module.ts`: 数据库基础模块
- `database/entities.module.ts`: 实体统一导出模块
- `config/config.module.ts`: 配置模块
- `redis/redis.module.ts`: Redis 缓存模块

### 1.2 服务层 (Services)
- `modules/auth/auth.service.ts`: 认证、Token、微信登录逻辑
- `modules/user/user.service.ts`: 用户资料、健康档案、BMR/TDEE 计算
- `modules/food-items/food-items.service.ts`: 食材搜索、创建、收藏、热门统计
- `modules/diet-plans/diet-plans.service.ts`: 计划管理、阶段计算、计划复制
- `modules/diet-records/diet-records.service.ts`: 每日打卡、餐次管理、首页聚合
- `modules/dict/dict.service.ts`: 字典查询
- `modules/share/share.service.ts`: 计划导入导出分享逻辑
- `redis/redis.service.ts`: Redis 操作封装

### 1.3 控制层 (Controllers)
- `app.controller.ts`: 基础状态检查
- `modules/auth/auth.controller.ts`: 登录、刷新 Token 接口
- `modules/user/user.controller.ts`: 个人中心、资料更新接口
- `modules/food-items/food-items.controller.ts`: 食材库 CRUD 及收藏接口
- `modules/diet-plans/diet-plans.controller.ts`: 饮食计划 CRUD
- `modules/diet-records/diet-records.controller.ts`: 每日打卡与记录接口
- `modules/dict/dict.controller.ts`: 字典接口
- `modules/share/share.controller.ts`: 分享接口

### 1.4 数据库实体 (Entities)
- `database/entity/user.entity.ts`: 用户基础表
- `database/entity/health-profile.entity.ts`: 用户健康档案表
- `database/entity/food-item.entity.ts`: 食材库表
- `database/entity/user-favorite-food.entity.ts`: 用户食材收藏表
- `database/entity/diet-plan.entity.ts`: 饮食计划主表
- `database/entity/plan-day.entity.ts`: 计划具体天数配置
- `database/entity/plan-meal.entity.ts`: 计划餐次配置
- `database/entity/plan-meal-item.entity.ts`: 计划餐次内食材配置
- `database/entity/daily-record.entity.ts`: 每日打卡主记录表
- `database/entity/meal-log.entity.ts`: 具体餐次打卡明细
- `database/entity/exercise-log.entity.ts`: 运动记录表
- `database/entity/exercise-type.entity.ts`: 运动类型字典
- `database/entity/weight-record.entity.ts`: 体重变化记录表
- `database/entity/plan-share.entity.ts`: 计划分享关联表
- `database/entity/data-dictionary.entity.ts`: 数据字典表

### 1.5 数据传输对象 (DTOs)
- `dtos/auth-login.dto.ts`: 登录请求
- `dtos/user.dto.ts`: 用户更新、微信授权
- `dtos/food-item.dto.ts`: 食材 CRUD
- `dtos/create-diet-plan.dto.ts`: 计划创建
- `dtos/update-diet-plan.dto.ts`: 计划更新
- `dtos/create-meal-log.dto.ts`: 餐次记录创建
- `dtos/update-meal-log.dto.ts`: 餐次记录更新
- `dtos/import-plan.dto.ts`: 计划导入
- `dtos/dict.dto.ts`: 字典查询

### 1.6 公共工具与中间件 (Common)
- `common/interceptors/transform.interceptor.ts`: 响应结构统一封装
- `common/interceptors/trim.interceptor.ts`: 输入参数自动去空格
- `common/filters/http-exception.filter.ts`: 全局异常处理
- `common/logger/app.logger.ts`: Winston 日志集成
- `common/logger/trace.middleware.ts`: TraceId 追踪中间件
- `common/transformers/user.transformer.ts`: 用户嵌套结构转换器
- `common/utils/trace.util.ts`: 链路追踪工具

---

## 2. 前端架构 (`fit_cycle_web/src`)

### 2.1 页面 (Pages)
- `pages/index/index.vue`: 首页 (今日记录、目标进度)
- `pages/food/index.vue`: 食材库 (分类搜索、热门食材)
- `pages/plan/index.vue`: 计划列表 (我的计划、推荐计划)
- `pages/plan-creator/index.vue`: 计划创建 (分步引导)
- `pages/daily-plan/index.vue`: 计划天数详情配置
- `pages/daily-list/index.vue`: 历史记录列表
- `pages/profile/index.vue`: 个人中心
- `pages/login/index.vue`: 登录页面
- `pages/carb-cycle-setup/index.vue`: 碳循环快速设置
- `pages/meal-config/index.vue`: 餐次时间与名称配置
- `pages/plan-detail/index.vue`: 计划预览详情
- `pages/plan-templates/index.vue`: 模板管理
- `pages/edit-template/index.vue`: 模板编辑

### 2.2 核心组件 (Components)
- `components/home/*`: 首页相关 (MacroMiniProgress, DailyGoalsOverview)
- `components/food/*`: 食材相关 (FoodPicker, FoodSelectorModal, FoodDetailModal)
- `components/plan/*`: 计划相关 (PlanCard, ImportPlanModal, BatchSetupModal)
- `components/plan-creator/*`: 创建流程步骤组件
- `components/daily-plan/*`: 饮食配置相关
- `components/common/*`: 通用原子组件 (GlassCard, BaseButton, BaseModal)

### 2.3 状态管理 (Stores)
- `stores/user.ts`: 用户认证与资料
- `stores/plan.ts`: 计划编辑中转状态
- `stores/record.ts`: 今日打卡数据缓存
- `stores/navigation.ts`: 导航状态

### 2.4 服务层 (Services)
- `services/http/request.ts`: 请求核心封装
- `services/http/interceptors.ts`: 拦截器逻辑 (Token 刷新)
- `services/modules/*`: 按业务模块划分的 API 调用

### 2.5 辅助工具 (Utils)
- `utils/carb-cycle-algo.ts`: 碳循环计算核心算法
- `utils/plan-converter.ts`: 计划数据结构转换工具
- `utils/error-handler.ts`: 错误处理
- `utils/env.ts`: 环境判断

---

## 3. 自动化测试架构 (`tests/minium`)

### 3.1 测试用例 (Test Cases)
- `case/test_plan_v7_7.py`: **V7.7 核心用例集** (含正向闭环、量化反馈、静默修复校验)
- `case/base_test.py`: Minium 测试基类 (自动注入 Token、环境初始化)

### 3.2 驱动与执行器 (Executors)
- `executor.py`: **自愈型执行器** (集成 JS 注入、错误重试、MD 报告自动生成)
- `protocol_tester.py`: **协议级驱动器** (在 UI 解析受限时，通过 API 契约验证业务灵魂逻辑)
- `run_plan_flow.py`: 简易 E2E 流程跑通工具

### 3.3 注入逻辑与辅助工具 (Utils)
- `utils/injected_logic.js`: **跨障碍 JS 脚本** (直接操作小程序 Page/Store 的原生逻辑)
- `utils/db_checker.py`: 后端 SQLite/MySQL 数据库校验工具
- `config.json`: Minium 运行环境配置 (端口、路径、Mock 策略)

### 3.4 测试成果 (Outputs)
- `outputs/REPORT_M-FOR-01.md`: 计划创建全流程功能测试报告
- `outputs/REPORT_M-FOR-03.md`: 数据量化与反馈功能测试报告
- `outputs/REPORT_M-REP-01.md`: 数据一致性与自修复功能测试报告
