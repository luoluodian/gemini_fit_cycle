# P-7 碳循环核心算法 测试报告 (T7)

## 1. 测试概览 (Test Overview)
- **测试目标**: 验证碳循环营养素分配算法的数学正确性、舍入完整性及边界条件处理。
- **测试环境**: Node.js v22.11.0
- **测试脚本**: `fit_cycle_web/src/utils/__tests__/carb-cycle-algo.test.js`

## 2. 测试用例与结果 (Test Cases & Results)

| 用例名称 | 测试重点 | 预期结果 | 实际结论 |
| :--- | :--- | :--- | :--- |
| **标准 7 天周期** | 验证常规输入下的计算逻辑 | `isBalanced` 为 true，序列长度为 7 | ✅ 通过 |
| **天数不平衡校验** | 验证分配天数与总天数不匹配时的逻辑 | `isBalanced` 为 false | ✅ 通过 |
| **权重 0 容错** | 验证极值输入下的稳定性 | 各阶段营养素和热量输出为 0 | ✅ 通过 |
| **热量数学一致性** | 验证取整后的克数与总热量是否匹配 | `Calories === P*4 + C*4 + F*9` | ✅ 通过 |

## 3. 核心发现 (Key Findings)
- **数学严谨性**: 算法成功实现了“克数优先取整，再算热量”的策略，解决了 UI 上数值可能不匹配的潜在 Bug。
- **序列生成**: `sequence` 数组能够准确根据高/中/低碳的天数分配生成对应的 Day 列表，为 Step 2 页面提供了直接的数据驱动。
- **稳定性**: 算法在非标准权重或不平衡天数下表现符合预期，具备良好的容错提示基础。

## 4. 结论 (Conclusion)
算法逻辑稳健，数学计算精确，符合业务需求。可以安全集成到 `carb-cycle-setup` 页面中。
