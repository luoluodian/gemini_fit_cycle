# T6 变更清单: I-4.2 响应式 Store 联动 (Reactive Linkage)

## 1. Store 层原子化加固 (Store Hardening)

### 1.1 更新 `useRecordStore` (`stores/record.ts`)
- **策略: 抗变异更新 (Non-mutating Update)**
    - 修改 `addMealLogAction`: 强制使用 `this.mealLogs = [...this.mealLogs, newLog]`。
    - **新增 `removeMealAction(id: number)`**:
        - 逻辑: 
            1. 调用 `services/record.ts` 的 `removeMealLog`。
            2. 成功后执行: `this.mealLogs = this.mealLogs.filter(m => m.id !== id)`。
            3. 收益: 实现“秒删”反馈，无需重刷页面。
- **策略: 时序令牌 (Time-slice Token)**
    - 修改 `fetchRecord`:
        - 在 `try` 块内记录请求时的 `const requestDate = date;`。
        - 在赋值前校验: `if (requestDate !== this.activeDate) return;`。
        - 收益: 杜绝快速切换日期导致的“跨天数据覆盖”。

## 2. 前端组件交互对接 (Component Binding)

### 2.1 更新 `components/home/HomeMealCard.vue`
- **逻辑剥离**:
    - 将组件内部原本在 `handleDeleteClick` 中发送的 `removeMealLog` 请求，转移到 `recordStore.removeMealAction` 中。
    - 组件仅负责触发 Action 并捕获错误。

### 2.2 验证响应式触发
- 确保 `DailyGoalsOverview` 绑定的 `summary` 和 `ratios` 是通过 `storeToRefs` 导出的，维持 Vue 3 的依赖追踪。

## 3. 验证计划 (Verification)

- **本地合并联动**:
    - [ ] 添加食物 -> 验证 `mealLogs` 长度增加，且进度环百分比**立即**跳变。
- **本地剔除联动**:
    - [ ] 删除食物 -> 验证卡片列表立即消失该项，且总热量**同步**减少。
- **极端时序验证**:
    - [ ] 连续快速切换 3 个日期 -> 验证最终显示的 `currentRecord` 是否准确属于最后一个点击的日期。

## 4. 结论
I-4.2 实现了“数据状态控制 UI”的完全体。通过引入非变异更新和时序校验，我们消除了前端状态管理中最常见的两类 Bug（UI 冻结与异步覆盖），为全链路持久化提供了稳固的响应式底座。
