# P-8 创建向导 Step 1.5 - 碳循环配置页面 分析报告

## 1. 业务目标 (Business Goal)
实现碳循环计划的精密配置页面。作为创建向导的中间步骤（Step 1.5），该页面负责收集决定整个周期营养分布的关键变量。页面通过 P-7 算法实现实时动态预览，确保用户在正式生成每日列表前，能直观理解不同系数配置对每日饮食目标的影响。

## 2. 原型细节深度分析 (Detailed Analysis)
参照 `html/carb-cycle-setup.html` (Context: `name=1`, `cycleDays=7`, `cycleCount=3`)：

### 2.1 基础信息区块 (Weight Input)
- **UI 元素**: 包含图标（⚖️ 秤）、标题“当前体重”、副标题“用于计算营养素摄入量”。
- **交互项**: 数值输入框 + 单位 "kg"。
- **默认值**: 70。步长: 0.1。范围: 1 ~ 300。

### 2.2 营养素基准配比 (Base Ratios)
- **UI 元素**: 标题“营养素配比”、副标题“每kg体重 / 天”。
- **输入维度**: 
  - **蛋白质**: 默认 2.0 g/kg/天 (背景色：Blue-50, 图标：🍗)。
  - **碳水**: 默认 3.0 g/kg/天 (背景色：Yellow-50, 图标：⚡)。
  - **脂肪**: 默认 0.8 g/kg/天 (背景色：Red-50, 图标：🥑)。
- **汇总显示**: `本周期(7天)总量：蛋白质 Xg · 碳水 Yg · 脂肪 Zg`。数值随输入实时变化。

### 2.3 阶段分配卡片 (Phase Specific Distribution)
共有三个并列卡片，分别对应高、中、低碳日：

#### A. 高碳日卡片 (Yellow Theme)
- **标识**: 🔥 图标，标题“高碳日”，描述“高碳水配置”。
- **输入**: 天数（默认 2）、蛋白质系数 (1.0)、碳水系数 (1.5)、脂肪系数 (0.7)。
- **实时结果**: 显示该阶段每日的 P/C/F 克数及总热量 (kcal)。

#### B. 中碳日卡片 (Emerald Theme)
- **标识**: ⚖️ 图标，标题“中碳日”，描述“基准配置”。
- **输入**: 天数（默认 3）、蛋白质系数 (1.0)、碳水系数 (1.0)、脂肪系数 (1.0)。
- **实时结果**: 同上。

#### C. 低碳日卡片 (Blue Theme)
- **标识**: ❄️ 图标，标题“低碳日”，描述“低碳水配置”。
- **输入**: 天数（默认 2）、蛋白质系数 (1.0)、碳水系数 (0.5)、脂肪系数 (1.3)。
- **实时结果**: 同上。

### 2.4 校验与导航逻辑
- **天数校验器 (Days Check)**:
  - 核心逻辑：`High.days + Medium.days + Low.days === cycleDays`。
  - **异常联动**: 若检测到 Store 中 `cycleDays` 发生变动（由于用户回退修改），分配区块的所有 `days` 输入项应重置为 0，强制用户重新平衡。
- **底部操作**:
  - **上一步**: 返回 Step 1 基础信息页。
  - **下一步**: 
    - 成功逻辑：调用 P-7 分配算法生成序列，**覆盖式更新** `planStore.draft.templates`。

### 2.5 视觉表现细节 (Visual Polish)
- **入场动画**: 页面区块需实现“交错式浮现”。
  - 基础信息：delay-0ms
  - 营养素配比：delay-100ms
  - 阶段卡片：delay-200ms 至 400ms。
- **数值变化**: 预览数值（Grams/Kcal）在变化时应具备平滑过渡效果（不跳动）。

## 3. 技术方案细化 (Technical Solution)

### 3.1 状态管理增强
- **计算属性**: 实现 `totalBudget` 计算属性，实时反映 `Weight * BaseRatio * cycleDays`。
- **监听器**: `watch(() => props.cycleDays)`，当总周期变化时，弹出提示并校验分配平衡。

## 4. 验收标准细化 (Acceptance Criteria)
- [ ] 实现 staggered 入场动画，效果与原型 `anime.js` 逻辑一致。
- [ ] 周期预算汇总（灰色区域）数值需随体重/比例/总天数实时响应。
- [ ] 阶段卡片底部的结果数值仅展示整数（由 P-7 处理舍入）。
- [ ] 确保“下一步”按钮在天数不平衡时处于 `disabled` 或 `opacity-50` 状态。
