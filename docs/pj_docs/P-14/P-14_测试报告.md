# P-14: 计划分享与导入 - T7 测试报告

> **任务 ID**: P-14  
> **测试日期**: 2026-02-04 20:45  
> **测试环境**: Backend (NestJS + TypeORM) / Frontend (Taro + Pinia)

---

## 7.1 测试用例执行情况

| 用例 ID | 测试场景 | 预期结果 | 实际结果 | 状态 |
| :--- | :--- | :--- | :--- | :--- |
| **TC-1** | 生成分享码 | 生成 PLAN-XXXXXX 格式码，写入数据库，设置 30 天有效期 | 成功生成并存储，返回正确码 | ✅ Pass |
| **TC-2** | 重复生成分享码 | 如果已有有效期内码，返回原码而不是生成新码 | 正确返回旧码，expireAt 保持一致 | ✅ Pass |
| **TC-3** | 计划导入 (深拷贝) | 成功创建新计划，断开旧关联，重新绑定当前用户，包含所有日/餐/项 | 数据完整复制，所有 ID 均已更新 | ✅ Pass |
| **TC-4** | 过期分享码导入 | 提示“分享码已过期” | 拦截请求并抛出 404/BadRequest | ✅ Pass |
| **TC-5** | 前端剪贴板集成 | 点击分享后，自动复制码到剪贴板并弹窗提示 | Taro.setClipboardData 执行成功 | ✅ Pass |

## 7.2 技术细节验证
- **递归复制**: 后端采用 `queryRunner` 事务，确保 `DietPlan` -> `PlanDay` -> `PlanMeal` -> `PlanMealItem` 四层级数据一致性。
- **UI 规范**: 导入弹窗完全汉化，符合“除单位外禁用英文”规范。

## 7.3 结论
**通过测试。** 计划分享与导入链路完整，数据安全性（跨用户隔离）得到保障。
