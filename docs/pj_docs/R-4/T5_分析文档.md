# T5 分析文档: R-4 首页仪表盘 UI (Home Dashboard)

## 1. 任务背景 (Task Background)
任务 **R-4** 是记录域的前端展示中枢。首页需要聚合展示当日的营养达成率，并提供按日期回溯的功能。目前首页仅有 Mock 逻辑，需升级为基于 V7 规约的真实数据流。

## 2. 页面布局与交互分析 (UI/UX Analysis)

### 2.1 页面线框图 (ASCII Wireframe)
```text
+---------------------------------------+
|  < [1]      今日记录         [Calendar] | <-- NavBar (含日期选择)
+---------------------------------------+
|  [2] <      2026年2月9日      >      | <-- DateNavigation (天级别切换)
+---------------------------------------+
|                                       |
|  [3] 营养汇总卡片 (DailyGoalsOverview) |
|  +---------------------------------+  |
|  |      (环形进度条) 1200 / 2000     |  |
|  |      P: 40%  C: 30%  F: 20%     |  |
|  +---------------------------------+  |
|                                       |
|  [4] 餐次卡片列表 (MealCard * 4)       |
|  +---------------------------------+  |
|  | 🍳 早餐 (0 / 500 kcal)      [+] |  | <-- 跳转添加
|  | (暂无记录)                       |  |
|  +---------------------------------+  |
|  ...                                  |
+---------------------------------------+
```

### 2.2 核心交互流
1.  **初始化**: 进入首页 -> 获取 `currentDate` (YYYY-MM-DD) -> 调用 `GET /records/:date`。
2.  **日期切换**: 点击左右箭头 -> 更新 `currentDate` -> 触发 `watch` 重新请求接口。
3.  **状态处理**:
    - **加载中**: 显示 Skeleton 或 Loading。
    - **空记录**: 接口返回预览目标 (R-2 逻辑)，进度环显示目标值，明细列表为空。

## 3. 技术实现要点 (Technical Implementation)

### 3.1 状态管理与数据映射
- **Store 依赖**: `usePlanStore` (用于计划概览), `useUserStore` (用于基础目标)。
- **响应式数据**: `recordInfo` 的类型需对齐后端 R-2 的返回结构：
    ```typescript
    interface RecordInfo {
      record: DailyRecord; // 后端实体
      meals: MealLog[];    // 关联明细
    }
    ```

### 3.2 组件属性对齐
- **DailyGoalsOverview**: 
    - `target` 源自 `recordInfo.record` 的具名列。
    - `current` 源自 `recordInfo.meals` 的聚合 `SUM` (建议在前端计算，减少后端字段)。
- **HomeMealCard**: 
    - 按 `mealType` (breakfast, lunch等) 过滤 `recordInfo.meals`。

## 4. 后端接口对接 (R-2 API)
- **Service 层**: 调用 `services/modules/record.ts` (需新建) 的 `getDailyRecord(date)`。
- **错误处理**: 若接口 404 (虽然 R-2 做了兜底，但仍需防范)，显示“获取数据失败”提示。

## 5. 潜在风险与对策 (Risks & Mitigations)
- **频繁请求**: 快速点击日期会导致大量请求。需在 `loadRecordInfo` 中加入简单的 `abort` 机制或“加载锁定”状态。
- **时区一致性**: 前端 `new Date()` 必须严格转换为 `YYYY-MM-DD` 字符串后再传参，避免 8 小时时差导致的“凌晨错位”问题。

## 6. 结论 (Conclusion)
R-4 任务的关键在于**从“假数据”到“真实快照”的过渡**。通过精确对接 R-2 接口，首页将成为展示饮食计划执行情况的最直观窗口。
