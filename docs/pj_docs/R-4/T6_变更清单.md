# T6 变更清单: R-4 首页仪表盘 UI (Home Dashboard)

## 1. 基础设施建设 (Infrastructure)

### 1.1 建立统一日期工具
- **文件**: `fit_cycle_web/src/utils/date.ts`
- **实现**:
    - `formatDate(date: Date): string` -> 生成 `YYYY-MM-DD`。
    - `getTodayString(): string` -> 获取本地当前日期的 YYYY-MM-DD 字符串。
    - `addDays(dateStr: string, days: number): string` -> 辅助 `DateNavigation` 切换。

### 1.2 类型定义对齐
- **文件**: `fit_cycle_web/src/services/modules/record.ts` (新建)
- **定义**:
    - `interface DailyRecord`: 属性包括 `targetCalories`, `targetProtein`, `targetFat`, `targetCarbs`, `date` 等 (对应后端实体)。
    - `interface MealLog`: 属性包括 `id`, `foodName`, `calories`, `mealType` 等。
    - `interface RecordInfoResponse`: `{ record: DailyRecord, meals: MealLog[] }`。

## 2. 前端页面重构 (Frontend Changes)

### 2.1 首页逻辑升级 (`pages/index/index.vue`)
- **数据流**: 
    - 移除所有硬编码的 Mock 数组。
    - `currentDate` 默认值改为 `getTodayString()`。
    - 使用 `watch(currentDate, ...)` 触发 `getDailyRecord(date)`。
- **状态管理**:
    - 引入 `isLoading` 状态，控制 `DailyGoalsOverview` 的 Skeleton 展示。
- **聚合计算**:
    - `nutritionConsumed` 计算属性基于 `recordInfo.meals` 的 `reduce` 实时求和。

### 2.2 组件属性更新
- **DailyGoalsOverview**: 
    - 更新 Props 接受整个 `DailyRecord` 对象。
- **DateNavigation**:
    - 增加“回到今天”按钮交互。
    - 点击左右箭头调用 `dateUtils.addDays`。

## 3. API 对接 (API Integration)
- **实现 `services/modules/record.ts`**:
    - `getDailyRecord(date: string)` -> 调用 `GET /records/${date}`。

## 4. 验证计划 (Verification)
- **日期切换闭环**:
    - [ ] 切换到昨天，验证接口是否带上正确的 `YYYY-MM-DD`。
    - [ ] 切换回今天，验证进度环是否正确重载。
- **快照展示校验**:
    - [ ] 验证后端返回的 `targetCalories` 是否正确渲染在进度环的“目标分母”位置。
- **时区防御**:
    - [ ] 模拟 23:59 分打开 App，验证日期是否保持在当日。

## 5. 样式与兼容性 (Style & Compatibility)
- 确保 Skeleton 在不同端（微信小程序/H5）的显示效果一致。
- 使用 Tailwind CSS 优化进度环在小屏手机上的布局。
